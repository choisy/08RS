<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>08RS data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="data_files/libs/clipboard/clipboard.min.js"></script>
<script src="data_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="data_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="data_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="data_files/libs/quarto-html/popper.min.js"></script>
<script src="data_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="data_files/libs/quarto-html/anchor.min.js"></script>
<link href="data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="data_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="data_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="data_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="data_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#constants" id="toc-constants" class="nav-link active" data-scroll-target="#constants"><span class="header-section-number">1</span> Constants</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages"><span class="header-section-number">2</span> Packages</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions"><span class="header-section-number">3</span> Functions</a></li>
  <li><a href="#saras-csv-file" id="toc-saras-csv-file" class="nav-link" data-scroll-target="#saras-csv-file"><span class="header-section-number">4</span> Saras’ CSV file</a></li>
  <li><a href="#raw-data" id="toc-raw-data" class="nav-link" data-scroll-target="#raw-data"><span class="header-section-number">5</span> Raw data</a>
  <ul>
  <li><a href="#rs-crf" id="toc-rs-crf" class="nav-link" data-scroll-target="#rs-crf"><span class="header-section-number">5.1</span> 08RS CRF</a></li>
  <li><a href="#ei-crf" id="toc-ei-crf" class="nav-link" data-scroll-target="#ei-crf"><span class="header-section-number">5.2</span> 02EI CRF</a></li>
  <li><a href="#pcr-data" id="toc-pcr-data" class="nav-link" data-scroll-target="#pcr-data"><span class="header-section-number">5.3</span> PCR data</a></li>
  <li><a href="#mri-data" id="toc-mri-data" class="nav-link" data-scroll-target="#mri-data"><span class="header-section-number">5.4</span> MRI data</a></li>
  </ul></li>
  <li><a href="#children-data" id="toc-children-data" class="nav-link" data-scroll-target="#children-data"><span class="header-section-number">6</span> Children data</a>
  <ul>
  <li><a href="#rs-pcr-mri" id="toc-rs-pcr-mri" class="nav-link" data-scroll-target="#rs-pcr-mri"><span class="header-section-number">6.1</span> 08RS, PCR, MRI</a></li>
  <li><a href="#patching-02ei-crf" id="toc-patching-02ei-crf" class="nav-link" data-scroll-target="#patching-02ei-crf"><span class="header-section-number">6.2</span> Patching 02EI CRF</a></li>
  <li><a href="#stunt-and-waste" id="toc-stunt-and-waste" class="nav-link" data-scroll-target="#stunt-and-waste"><span class="header-section-number">6.3</span> Stunt and waste</a></li>
  <li><a href="#missing-values" id="toc-missing-values" class="nav-link" data-scroll-target="#missing-values"><span class="header-section-number">6.4</span> Missing values</a></li>
  </ul></li>
  <li><a href="#m-abc-data" id="toc-m-abc-data" class="nav-link" data-scroll-target="#m-abc-data"><span class="header-section-number">7</span> M-ABC data</a></li>
  <li><a href="#bayley-data" id="toc-bayley-data" class="nav-link" data-scroll-target="#bayley-data"><span class="header-section-number">8</span> Bayley data</a></li>
  <li><a href="#time-points" id="toc-time-points" class="nav-link" data-scroll-target="#time-points"><span class="header-section-number">9</span> Time points</a>
  <ul>
  <li><a href="#m-abc-data-1" id="toc-m-abc-data-1" class="nav-link" data-scroll-target="#m-abc-data-1"><span class="header-section-number">9.1</span> M-ABC data</a></li>
  <li><a href="#bayley-data-1" id="toc-bayley-data-1" class="nav-link" data-scroll-target="#bayley-data-1"><span class="header-section-number">9.2</span> Bayley data</a></li>
  <li><a href="#merging" id="toc-merging" class="nav-link" data-scroll-target="#merging"><span class="header-section-number">9.3</span> Merging</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization"><span class="header-section-number">9.4</span> Visualization</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis"><span class="header-section-number">10</span> Analysis</a>
  <ul>
  <li><a href="#hfmd-vs-controls" id="toc-hfmd-vs-controls" class="nav-link" data-scroll-target="#hfmd-vs-controls"><span class="header-section-number">10.1</span> HFMD vs controls</a></li>
  <li><a href="#propensity-scores" id="toc-propensity-scores" class="nav-link" data-scroll-target="#propensity-scores"><span class="header-section-number">10.2</span> Propensity scores</a></li>
  <li><a href="#responses" id="toc-responses" class="nav-link" data-scroll-target="#responses"><span class="header-section-number">10.3</span> Responses</a></li>
  <li><a href="#plotting-effects" id="toc-plotting-effects" class="nav-link" data-scroll-target="#plotting-effects"><span class="header-section-number">10.4</span> Plotting effects</a></li>
  </ul></li>
  <li><a href="#ev-a71-and-severe-cases" id="toc-ev-a71-and-severe-cases" class="nav-link" data-scroll-target="#ev-a71-and-severe-cases"><span class="header-section-number">11</span> EV-A71 and severe cases</a>
  <ul>
  <li><a href="#severe-cases" id="toc-severe-cases" class="nav-link" data-scroll-target="#severe-cases"><span class="header-section-number">11.1</span> Severe cases</a></li>
  <li><a href="#ev71-cases" id="toc-ev71-cases" class="nav-link" data-scroll-target="#ev71-cases"><span class="header-section-number">11.2</span> EV71 cases</a></li>
  <li><a href="#severe-ev71-cases" id="toc-severe-ev71-cases" class="nav-link" data-scroll-target="#severe-ev71-cases"><span class="header-section-number">11.3</span> Severe EV71 cases</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">08RS data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="constants" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="constants"><span class="header-section-number">1</span> Constants</h2>
<p>The path to the data folder on the local computer:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>root <span class="ot">&lt;-</span> <span class="st">"~/Library/CloudStorage/OneDrive-OxfordUniversityClinicalResearchUnit"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data_folder <span class="ot">&lt;-</span> <span class="fu">paste0</span>(root, <span class="st">"/GitHub/choisy/08RS/"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="packages" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="packages"><span class="header-section-number">2</span> Packages</h2>
<p>Required packages:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>required <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"readxl"</span>, <span class="st">"purrr"</span>, <span class="st">"dplyr"</span>, <span class="st">"magrittr"</span>, <span class="st">"tidyr"</span>, <span class="st">"anthro"</span>, <span class="st">"twang"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"cobalt"</span>, <span class="st">"survey"</span>, <span class="st">"tmle"</span>, <span class="st">"RColorBrewer"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Installing those that are not installed yet:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>to_install <span class="ot">&lt;-</span> required[<span class="sc">!</span> required <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="st">"Package"</span>]]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(to_install)) <span class="fu">install.packages</span>(to_install)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Loading some packages for interactive use:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(twang)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmle)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="functions" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="functions"><span class="header-section-number">3</span> Functions</h2>
<p>A tuning of the <code>readxl::read_excel()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>read_excel2 <span class="ot">&lt;-</span> <span class="cf">function</span>(file, ...) readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="fu">paste0</span>(data_folder, file), ...)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that reads all the tabs of an excel file in the data folder <code>data_folder</code> defined above:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>read_excel_file <span class="ot">&lt;-</span> <span class="cf">function</span>(file) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  sheets_names <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">excel_sheets</span>(<span class="fu">paste0</span>(data_folder, file))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  sheets_names <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">read_excel2</span>(file, .x)) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(sheets_names)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that remove some slots of a list, by names:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>remove_slots <span class="ot">&lt;-</span> <span class="cf">function</span>(lst, slt) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  lst[<span class="fu">setdiff</span>(<span class="fu">names</span>(lst), slt)]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that extracts some variables of some slots of a list <code>x</code> of data frames:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>get_vars <span class="ot">&lt;-</span> <span class="cf">function</span>(sel, x) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">extract</span>(<span class="fu">names</span>(sel)) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map2</span>(sel, <span class="sc">~</span> <span class="fu">select</span>(.x, <span class="sc">!!!</span>.y))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The variables in questions are defined in the named list <code>sel</code> of character vectors. The names of this list should be among the names of <code>x</code> and the character vectors of each slots should be among the names of the columns of the data frames in the corresponding slots. A function that patches data values from the data frame <code>patch</code> into the data frame <code>df</code>, using the <code>key</code> variable as a common key between the two data frames:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>patch <span class="ot">&lt;-</span> <span class="cf">function</span>(patch, df, key) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  ref <span class="ot">&lt;-</span> df[, key]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> df[[key]] <span class="sc">%in%</span> patch[[key]]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> df[sel, ]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  tmp_names <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(patch, tmp[, <span class="fu">setdiff</span>(tmp_names, <span class="fu">names</span>(patch))])[tmp_names]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  df[<span class="sc">!</span> sel, ] <span class="sc">|&gt;</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(tmp) <span class="sc">|&gt;</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(<span class="at">x =</span> ref, <span class="at">y =</span> _, <span class="at">by =</span> key)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that renames a column of a data frame:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rename2 <span class="ot">&lt;-</span> <span class="cf">function</span>(df, newname, oldname) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  df_names <span class="ot">&lt;-</span> <span class="fu">names</span>(df)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  df_names[<span class="fu">which</span>(df_names <span class="sc">==</span> oldname)] <span class="ot">&lt;-</span> newname</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(df, df_names)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that splits a data frame into a list of data frames:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>split_df <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n_rows) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  nb_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(x, <span class="fu">gl</span>(nb_rows <span class="sc">%/%</span> n_rows <span class="sc">+</span> (nb_rows <span class="sc">%%</span> n_rows <span class="sc">&gt;</span> <span class="dv">0</span>), n_rows, nb_rows))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that appends a data frame <code>x</code> with <code>n</code> rows of values <code>v</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>append_dataframe <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">v =</span> <span class="dv">0</span>) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(x) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">rep</span>(v, n)) <span class="sc">|&gt;</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(<span class="fu">names</span>(x)) <span class="sc">|&gt;</span>  </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    (\(y) <span class="fu">bind_rows</span>(x, y))()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that applies <code>append_dataframe()</code> to the last slot of a list <code>x</code> of data frame so that the number of rows of the data frame in the last slot is equal to the number of rows of the data frame in the first lost:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>append_last <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">v =</span> <span class="dv">1</span>) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  nb_slots <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  nb_rows1 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x[[<span class="dv">1</span>]])</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  nb_rows2 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x[[nb_slots]])</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (nb_rows2 <span class="sc">&lt;</span> nb_rows1) {</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x[[nb_slots]] <span class="ot">&lt;-</span> <span class="fu">append_dataframe</span>(x[[nb_slots]], nb_rows1 <span class="sc">-</span> nb_rows2, v)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>image()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>image2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, z, ...) <span class="fu">image</span>(x, y, <span class="fu">t</span>(z[<span class="fu">nrow</span>(z)<span class="sc">:</span><span class="dv">1</span>, ]), ...)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that adds a zero y value to both ends of a data frame with two columns <code>x</code> and <code>y</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>adding_zero_ys <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(x[<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)])</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">head</span>(x, <span class="dv">1</span>), x, <span class="fu">tail</span>(x, <span class="dv">1</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>y[<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(x))] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that converts a 1-row matrix with columns names into a named vector:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>as_vector <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">setNames</span>(<span class="fu">as.vector</span>(x), <span class="fu">colnames</span>(x))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>coef()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>coef2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">last</span>(<span class="fu">coef</span>(x))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>confint()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>confint2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">as_vector</span>(<span class="fu">last</span>(<span class="fu">suppressMessages</span>(<span class="fu">confint</span>(x))))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that retrieve the p value of the last parameter of a model:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>get_p <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">last</span>(<span class="fu">as.vector</span>(<span class="fu">coefficients</span>(<span class="fu">summary</span>(x))))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>svyglm()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>svyglm2 <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data, w) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> w, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svyglm</span>(formula, <span class="at">design =</span> _)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Shortcut to <code>magrittr::extract(...)</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>mextract  <span class="ot">&lt;-</span> <span class="cf">function</span>(...) magrittr<span class="sc">::</span><span class="fu">extract</span>(...)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Shortcut to <code>magrittr::extract2(...)</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mextract2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) magrittr<span class="sc">::</span><span class="fu">extract2</span>(...)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that pads density coordinates with y zero value points:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pad_density <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> x<span class="sc">$</span>x</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">c</span>(tmp[<span class="dv">1</span>], tmp, <span class="fu">last</span>(tmp))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, x<span class="sc">$</span>y, <span class="dv">0</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>density()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>density2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">pad_density</span>(<span class="fu">density</span>(...))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>polygon()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>polygon2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">polygon</span>(..., <span class="at">border =</span> <span class="cn">NA</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that computes the range of a variable <code>var</code> across a list <code>x</code> of data frames:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>range2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, var) {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(mextract2, var) <span class="sc">|&gt;</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">range</span>()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>mtext()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mtext2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">mtext</span>(..., <span class="at">cex =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>hist()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>hist2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) <span class="fu">hist</span>(x, <span class="cf">function</span>(x) <span class="fu">min</span>(x)<span class="sc">:</span><span class="fu">max</span>(x), ...)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="saras-csv-file" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="saras-csv-file"><span class="header-section-number">4</span> Saras’ CSV file</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>saras <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(root, <span class="st">"/GitHub/choisy/08RS/complete data including "</span>,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"all withdrawals_updated26_3_21.csv"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(saras, waste, visitM, ddifENB, ddifEN, FUP, FUP1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,408 × 6
   waste      visitM ddifENB ddifEN FUP   FUP1 
   &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
 1 Not Wasted      2      NA    547 18m   18m  
 2 Not Wasted     NA     184     NA 6m    &lt;NA&gt; 
 3 Not Wasted      1      NA      3 ENROL ENROL
 4 Not Wasted      2      NA    547 18m   18m  
 5 Not Wasted      1     182    182 6m    6m   
 6 Not Wasted     NA      11     NA ENROL &lt;NA&gt; 
 7 Not Wasted     NA     567     NA 18m   &lt;NA&gt; 
 8 Not Wasted     NA     204     NA 6m    &lt;NA&gt; 
 9 Not Wasted     NA      14     NA ENROL &lt;NA&gt; 
10 Not Wasted     NA      16     NA prem  &lt;NA&gt; 
# ℹ 1,398 more rows</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(saras<span class="sc">$</span>waste)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Not Wasted      Waste 
      1350         43 </code></pre>
</div>
</div>
</section>
<section id="raw-data" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="raw-data"><span class="header-section-number">5</span> Raw data</h2>
<section id="rs-crf" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="rs-crf"><span class="header-section-number">5.1</span> 08RS CRF</h3>
<p>Loading the data from CliRes:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>CRF08RS <span class="ot">&lt;-</span> <span class="fu">read_excel_file</span>(<span class="st">"6-11-2024-CTU08RS_Data.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The names of the data frames in CliRes and in Saras’ code, with definitions:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CliRes        Saras           Definition</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ENROL         data_EN         enrollment</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># HIST          data_HIST       history at enrollment</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># CONHIST       CONHIST         contact history at enrollment</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># EXAM          data_EX         symptoms and signs at enrollment</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># LAB           data_LAB        lab results at admission</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># NEU           data_NEU        neurological exam</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># DAILY         data_Daily      daily review</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># MED           data_MED        medications</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># DEVSOCSED     data_DEV        development and socio-economic data</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># DISC          data_DISC       discharge summary</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co"># FUP           data_FUP        first follow-up day 7-10</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># FUP_II        data_FUP6m      first follow-up month 6</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># FUP_III       data_FUP18m     first follow-up month 18</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co"># NEURO         data_NEURO      neurological assessment</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ABC           data_MABC       movement ABC-2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The 08RS CRF dictionary:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>CRF_dict <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">devsocsed =</span> <span class="fu">list</span>(<span class="at">MomEdu =</span> <span class="fu">c</span>(<span class="st">"Never been to school"</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Attended some primary school"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Completed primary school (5th gr)"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Completed lower secondary school (9th gr)"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Completed higher secondary school (12th gr)"</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Completed university/college degree"</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Completed postgraduate degree"</span>),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Toilet =</span> <span class="fu">c</span>(<span class="st">"Own flush toilet"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Shared flush toilet"</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Traditional pit toilet"</span>,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Ventilation improved pit toilet"</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"No facility/bush/field"</span>,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"None of above"</span>),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Water  =</span> <span class="fu">c</span>(<span class="st">"Private tap"</span>,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Public standpipe"</span>,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Bottled water"</span>,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Well in own residence"</span>,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Public well"</span>,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Rain water"</span>,</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Spring"</span>,</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"River/lake/pond"</span>, <span class="cn">NA</span>,</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"None of the above"</span>)),</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">disc =</span> <span class="fu">list</span>(<span class="at">GradeHFMD   =</span> <span class="fu">c</span>(<span class="st">"grade 1"</span>,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"grade 2a"</span>,</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"grade 2b(1)"</span>,</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"grade 2b(2)"</span>,</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"grade 3"</span>,</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"grade 4"</span>,</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Not Applicable"</span>),</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">Outcome     =</span> <span class="fu">c</span>(<span class="st">"Full recovery without complication"</span>,</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Incomplete recovery"</span>,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Transferred to another hospital"</span>,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Taken home without approval"</span>,</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Death"</span>,</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Discharged to die"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Selection of variables from the 08RS CRF:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>selection08RS <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ENROL     =</span> <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"DateEnrol"</span>, <span class="st">"Gender"</span>, <span class="st">"DateBirth"</span>),</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">HIST      =</span> <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"DateIllness"</span>, <span class="st">"DateAdmHTD"</span>, <span class="st">"DateAdmHTD"</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"DateAdmHosp"</span>, <span class="st">"HFMDToday"</span>, <span class="st">"HFMDAdmitted"</span>),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">EXAM      =</span> <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"headCircumference"</span>, <span class="st">"height"</span>, <span class="st">"weigh"</span>),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">DEVSOCSED =</span> <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"MomEdu"</span>, <span class="st">"Toilet"</span>, <span class="st">"Refrigerator"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"AirConditioner"</span>, <span class="st">"Motorbike"</span>, <span class="st">"Water"</span>),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">DISC      =</span> <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"DateDisc"</span>, <span class="st">"GradeHFMD"</span>, <span class="st">"TreatSepsis"</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Outcome"</span>, <span class="st">"Seizure"</span>, <span class="st">"Hypertonicity"</span>, <span class="st">"LimbPara"</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"CNP"</span>, <span class="st">"DiapWeak"</span>, <span class="st">"Trache"</span>, <span class="st">"Nasotube"</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"BehaveChange"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="ei-crf" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="ei-crf"><span class="header-section-number">5.2</span> 02EI CRF</h3>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>CRF02EI <span class="ot">&lt;-</span> <span class="fu">read_excel_file</span>(<span class="st">"6-11-2024-CTU02EI_Data.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Selection of variables from the 02EI CRF:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>selection02EI <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Demo  =</span> <span class="fu">c</span>(<span class="st">"studyCode"</span>, <span class="st">"height"</span>, <span class="st">"weight"</span>),</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Hist  =</span> <span class="fu">c</span>(<span class="st">"studyCode"</span>, <span class="st">"IllnessDate"</span>),</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Disch =</span> <span class="fu">c</span>(<span class="st">"studyCode"</span>, <span class="st">"seizures"</span>, <span class="st">"tracheostomy"</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"muscleStength"</span>, <span class="st">"limbParalysing"</span>, <span class="st">"nerveParalysing"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="pcr-data" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="pcr-data"><span class="header-section-number">5.3</span> PCR data</h3>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>PCR <span class="ot">&lt;-</span> <span class="st">"03EI-08RS PCR-Seq result.xlsx"</span> <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel2</span>(<span class="st">"08RS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, <span class="st">`</span><span class="at">OUCRU RESULT</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(ID, as.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.exclude</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="mri-data" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="mri-data"><span class="header-section-number">5.4</span> MRI data</h3>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>MRI <span class="ot">&lt;-</span> <span class="fu">paste0</span>(root, <span class="st">"/GitHub/choisy/08RS/part_dataMRIentry_28AUG15_errorcor.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>() <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID =</span> code) <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Final, Acute) <span class="sc">|&gt;</span> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">"Final"</span>, <span class="st">"Acute"</span>), <span class="sc">~</span> .x <span class="sc">==</span> <span class="st">"Yes"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>What is the difference between <code>Final</code> and <code>Acute</code>?</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(MRI, Final <span class="sc">!=</span> Acute)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
      ID Final Acute
   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;
 1    47 TRUE  FALSE
 2    51 TRUE  FALSE
 3   550 TRUE  FALSE
 4   551 TRUE  FALSE
 5   557 TRUE  FALSE
 6   575 TRUE  FALSE
 7   596 TRUE  FALSE
 8   597 TRUE  FALSE
 9   599 TRUE  FALSE
10   622 TRUE  FALSE</code></pre>
</div>
</div>
</section>
</section>
<section id="children-data" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="children-data"><span class="header-section-number">6</span> Children data</h2>
<section id="rs-pcr-mri" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="rs-pcr-mri"><span class="header-section-number">6.1</span> 08RS, PCR, MRI</h3>
<p>The case and control groups:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"HFMD"</span>, <span class="dv">299</span>), <span class="fu">rep</span>(<span class="st">"control"</span>, <span class="dv">200</span>),</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="st">"HFMD"</span>, <span class="dv">200</span>), <span class="fu">rep</span>(<span class="st">"control"</span>, <span class="dv">299</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>First recoding of variables:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>recoding1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(Gender, <span class="sc">~</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)[.x]),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Date"</span>), as.Date),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(<span class="fu">c</span>(<span class="st">"Refrigerator"</span>, <span class="st">"AirConditioner"</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Motorbike"</span>, <span class="st">"TreatSepsis"</span>), <span class="sc">~</span> .x <span class="sc">&lt;</span> <span class="dv">2</span>))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Second recoding of variables:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>recoding2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(HFMD, <span class="sc">~</span> CRF_dict<span class="sc">$</span>disc<span class="sc">$</span>GradeHFMD[.x]),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(MomEdu, <span class="sc">~</span> CRF_dict<span class="sc">$</span>devsocsed<span class="sc">$</span>MomEdu[.x]),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(Toilet, <span class="sc">~</span> CRF_dict<span class="sc">$</span>devsocsed<span class="sc">$</span>Toilet[.x]),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(Water, <span class="sc">~</span> CRF_dict<span class="sc">$</span>devsocsed<span class="sc">$</span>Water[.x]),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(Outcome, <span class="sc">~</span> CRF_dict<span class="sc">$</span>disc<span class="sc">$</span>Outcome[.x]))</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Selecting and recoding the variables from the 08RS CRF, and assigning to case or control:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>children <span class="ot">&lt;-</span> selection08RS <span class="sc">|&gt;</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_slots</span>(<span class="st">"ABC"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_vars</span>(CRF08RS) <span class="sc">|&gt;</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(left_join, <span class="at">by =</span> <span class="st">"ParNo"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">HFMD =</span> <span class="fu">max</span>(<span class="fu">across</span>(<span class="fu">c</span>(HFMDToday, HFMDAdmitted, GradeHFMD)))) <span class="sc">|&gt;</span> <span class="co">#takes max grade</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recoding1</span>() <span class="sc">|&gt;</span> </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recoding2</span>() <span class="sc">|&gt;</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID    =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(ParNo, <span class="st">"^.*-"</span>)),</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> groups[ID]) <span class="sc">|&gt;</span> </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(MRI, <span class="st">"ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(PCR, <span class="st">"ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">PCR =</span> <span class="st">`</span><span class="at">OUCRU RESULT</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>HFMDToday, <span class="sc">-</span>HFMDAdmitted, <span class="sc">-</span>GradeHFMD, <span class="sc">-</span>ID) <span class="sc">|&gt;</span> </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ParNo, Gender, DateBirth, DateIllness, DateAdmHosp,</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>         DateAdmHTD, DateEnrol, DateDisc, <span class="fu">everything</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ParNo)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="patching-02ei-crf" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="patching-02ei-crf"><span class="header-section-number">6.2</span> Patching 02EI CRF</h3>
<p>Conversion of IDs between 02EI and 08RS:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>(ID_conv <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">s02EI =</span> <span class="fu">paste0</span>(<span class="st">"03-0"</span>, <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"0"</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">9</span>)), <span class="fu">c</span>(<span class="st">"11"</span>, <span class="st">"13"</span>))),</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">s08RS =</span> <span class="fu">paste0</span>(<span class="st">"03-0"</span>, <span class="fu">c</span>(<span class="dv">43</span>, <span class="dv">52</span><span class="sc">:</span><span class="dv">56</span>, <span class="dv">60</span>, <span class="dv">62</span>, <span class="dv">78</span>, <span class="dv">79</span>))))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   s02EI  s08RS 
   &lt;chr&gt;  &lt;chr&gt; 
 1 03-001 03-043
 2 03-003 03-052
 3 03-004 03-053
 4 03-005 03-054
 5 03-006 03-055
 6 03-007 03-056
 7 03-008 03-060
 8 03-009 03-062
 9 03-011 03-078
10 03-013 03-079</code></pre>
</div>
</div>
<p>Patching the data values from the 02EI CRF:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>children <span class="ot">&lt;-</span> selection02EI <span class="sc">|&gt;</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_vars</span>(CRF02EI) <span class="sc">|&gt;</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(left_join, <span class="at">by =</span> <span class="st">"studyCode"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(IllnessDate, as.Date),</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(<span class="st">"seizures"</span>, <span class="st">"tracheostomy"</span>, <span class="st">"muscleStength"</span>, <span class="st">"limbParalysing"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nerveParalysing"</span>), <span class="sc">~</span> .x <span class="sc">&lt;</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ParNo         =</span> studyCode,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">weigh         =</span> weight,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">DateIllness   =</span> IllnessDate,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Seizure       =</span> seizures,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">Trache        =</span> tracheostomy,</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Hypertonicity =</span> muscleStength,</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">LimbPara      =</span> limbParalysing,</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">CNP           =</span> nerveParalysing) <span class="sc">|&gt;</span> </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ParNo <span class="sc">%in%</span> ID_conv<span class="sc">$</span>s02EI) <span class="sc">|&gt;</span> </span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(ParNo, <span class="sc">~</span> <span class="fu">unname</span>(<span class="fu">with</span>(ID_conv, <span class="fu">setNames</span>(s08RS, s02EI))[.x]))) <span class="sc">|&gt;</span> </span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">patch</span>(children, <span class="st">"ParNo"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="stunt-and-waste" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="stunt-and-waste"><span class="header-section-number">6.3</span> Stunt and waste</h3>
<p>A function that computes stunt and waste variable from weight and height variables:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>stunt_waste <span class="ot">&lt;-</span> <span class="cf">function</span>(x, weight, height) {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age =</span> DateEnrol <span class="sc">-</span> DateBirth,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">z   =</span> anthro<span class="sc">::</span><span class="fu">anthro_zscores</span>(<span class="fu">c</span>(<span class="at">male =</span> <span class="dv">1</span>, <span class="at">female =</span> <span class="dv">2</span>)[Gender],</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">as.numeric</span>(age),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">weight =</span> {{ weight }},</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">lenhei =</span> {{ height }})[<span class="fu">c</span>(<span class="st">"zlen"</span>, <span class="st">"zwfl"</span>)]) <span class="sc">|&gt;</span> </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(z) <span class="sc">|&gt;</span> </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">stunting =</span> zlen <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">wasting  =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(zwfl) <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>                                zwfl <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"severe"</span>,</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>                                zwfl <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"moderate"</span>,</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">.default =</span> <span class="st">"no"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(zlen, zwfl))</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Adding stunt and waste data to the <code>children</code> data frame:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>children <span class="ot">&lt;-</span> <span class="fu">stunt_waste</span>(children, weigh, height)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="missing-values" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="missing-values"><span class="header-section-number">6.4</span> Missing values</h3>
<p>A function that computes the numbers and percentages of missing values per variable:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>number_of_NA <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span> group) <span class="sc">|&gt;</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.x))) <span class="sc">|&gt;</span> </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">!</span> ParNo, <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"number_of_NA"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">percentage_of_NA =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> number_of_NA <span class="sc">/</span> n)) <span class="sc">|&gt;</span> </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span> ParNo)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s look at the missing values among cases:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>cases <span class="ot">&lt;-</span> <span class="fu">filter</span>(children, group <span class="sc">==</span> <span class="st">"HFMD"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cases)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>cases <span class="sc">|&gt;</span> </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">number_of_NA</span>() <span class="sc">|&gt;</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 3
   variable          number_of_NA percentage_of_NA
   &lt;chr&gt;                    &lt;int&gt;            &lt;dbl&gt;
 1 Gender                       0                0
 2 DateBirth                    0                0
 3 DateIllness                  0                0
 4 DateAdmHosp                239               98
 5 DateAdmHTD                   5                2
 6 DateEnrol                    0                0
 7 DateDisc                     9                4
 8 headCircumference          135               56
 9 height                     115               47
10 weigh                      114               47
11 MomEdu                       0                0
12 Toilet                       1                0
13 Refrigerator                 0                0
14 AirConditioner               0                0
15 Motorbike                    0                0
16 Water                        0                0
17 TreatSepsis                 19                8
18 Outcome                      9                4
19 Seizure                      0                0
20 Hypertonicity                0                0
21 LimbPara                     0                0
22 CNP                          0                0
23 DiapWeak                     9                4
24 Trache                       0                0
25 Nasotube                     9                4
26 BehaveChange                 9                4
27 HFMD                        16                7
28 Final                      155               64
29 Acute                      155               64
30 PCR                          1                0
31 age                          0                0
32 stunting                   115               47
33 wasting                    115               47</code></pre>
</div>
</div>
<p>And among controls:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>controls <span class="ot">&lt;-</span> <span class="fu">filter</span>(children, group <span class="sc">==</span> <span class="st">"control"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(controls)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>controls <span class="sc">|&gt;</span> </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">number_of_NA</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(percentage_of_NA <span class="sc">&lt;</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 3
   variable          number_of_NA percentage_of_NA
   &lt;chr&gt;                    &lt;int&gt;            &lt;dbl&gt;
 1 Gender                       0                0
 2 DateBirth                    0                0
 3 DateEnrol                    0                0
 4 headCircumference            2                1
 5 height                       2                1
 6 weigh                        1                0
 7 MomEdu                       1                0
 8 Toilet                       0                0
 9 Refrigerator                 0                0
10 AirConditioner               0                0
11 Motorbike                    0                0
12 Water                        0                0
13 age                          0                0
14 stunting                     2                1
15 wasting                      3                1</code></pre>
</div>
</div>
<p>Retrieving the height, weight and stunt data from Saras’ CSV file:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>saras_stunt <span class="ot">&lt;-</span> saras <span class="sc">|&gt;</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code, WEIGHT, HEIGHT, headCircumference, stunt, waste) <span class="sc">|&gt;</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ParNo =</span> <span class="fu">paste0</span>(<span class="fu">ifelse</span>(code <span class="sc">&lt;</span> <span class="dv">923</span>, <span class="st">"03-"</span>, <span class="st">"05-"</span>), <span class="fu">sprintf</span>(<span class="st">"%03d"</span>, code)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Merging with our children data frame:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>comparing_data <span class="ot">&lt;-</span> children <span class="sc">|&gt;</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ParNo, height, weigh, stunting) <span class="sc">|&gt;</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(saras_stunt, <span class="st">"ParNo"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Checking that children codes match:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(saras_stunt<span class="sc">$</span>ParNo, comparing_data<span class="sc">$</span>ParNo)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(comparing_data<span class="sc">$</span>ParNo, saras_stunt<span class="sc">$</span>ParNo)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>plot_comp <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(..., <span class="at">col =</span> <span class="fu">adjustcolor</span>(<span class="dv">4</span>, .<span class="dv">15</span>), <span class="at">pch =</span> <span class="dv">19</span>,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">"CRF"</span>, <span class="at">ylab =</span> <span class="st">"Saras'"</span>, <span class="at">asp =</span> <span class="dv">1</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col =</span> <span class="dv">2</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Comparing height and weight data:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">pty =</span> <span class="st">"s"</span>, <span class="at">plt =</span> <span class="fu">rep</span>(<span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">93</span>), <span class="dv">2</span>), <span class="at">bty =</span> <span class="st">"o"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>comparing_data <span class="sc">|&gt;</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_out</span>(<span class="fu">is.na</span>(height)) <span class="sc">|&gt;</span> </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">plot_comp</span>(height, HEIGHT))</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"heights (cm)"</span>, <span class="at">line =</span> .<span class="dv">2</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>comparing_data <span class="sc">|&gt;</span> </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_out</span>(<span class="fu">is.na</span>(weigh)) <span class="sc">|&gt;</span> </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">plot_comp</span>(weigh, WEIGHT))</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"weights (kg)"</span>, <span class="at">line =</span> .<span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_comparisons-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Comparing stunt data:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>comparing_data <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(stunt, <span class="sc">~</span> .x <span class="sc">==</span> <span class="st">"Stunt"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_out</span>(<span class="fu">is.na</span>(stunting)) <span class="sc">|&gt;</span> </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stunting, stunt) <span class="sc">|&gt;</span> </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">|&gt;</span> </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"CRF"</span>, <span class="st">"Saras'"</span>, <span class="st">"n"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  CRF   `Saras'`     n
  &lt;lgl&gt; &lt;lgl&gt;    &lt;int&gt;
1 FALSE FALSE      355
2 FALSE TRUE         6
3 TRUE  TRUE        59</code></pre>
</div>
</div>
<p>Patching the <code>children</code> data frame with Saras’ CSV file for weight, height, stunt and waste, and recomputing our stunting and wasting data:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>children <span class="ot">&lt;-</span> children <span class="sc">|&gt;</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(saras_stunt, <span class="st">"ParNo"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(stunt, <span class="sc">~</span> .x <span class="sc">==</span> <span class="st">"Stunt"</span>),</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(waste, <span class="sc">~</span> .x <span class="sc">==</span> <span class="st">"Waste"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stunt_waste</span>(WEIGHT, HEIGHT)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="m-abc-data" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="m-abc-data"><span class="header-section-number">7</span> M-ABC data</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>ABC <span class="ot">&lt;-</span> CRF08RS<span class="sc">$</span>ABC <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ParNo, DateTested, <span class="fu">ends_with</span>(<span class="st">"ISS"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Date"</span>), as.Date)) <span class="sc">|&gt;</span> </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ParNo, DateTested)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Of note, here</p>
<ul>
<li><code>MD</code> stands for manual dexterity,</li>
<li><code>AC</code> stands for aiming and catching and</li>
<li><code>BAL</code> stands for balance.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>ABC <span class="sc">|&gt;</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.exclude</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 221 × 10
   ParNo  DateTested MD1ISS MD2ISS MD3ISS AC1ISS AC2ISS BAL1ISS BAL2ISS BAL3ISS
   &lt;chr&gt;  &lt;date&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 03-001 2013-06-21      4      8      0      0      0       0       0       0
 2 03-001 2014-12-17      3     10      6     11      6       6       7       1
 3 03-001 2015-06-30      5     12      1      9     10       3       1       1
 4 03-003 2015-01-15     11     14     13     12     14      14      13      12
 5 03-004 2015-01-20     14     16      1      9      6       7       7       6
 6 03-007 2015-02-02      9     10      5      8     12      10      11       6
 7 03-010 2014-03-20      6     11      1      7     11       6      13       6
 8 03-010 2015-03-20     12     12      6     11     12       8      13       4
 9 03-016 2015-04-07      8     14     12     12     12       9      13       5
10 03-020 2014-06-24     11     13     10     12     11       9      13      12
# ℹ 211 more rows</code></pre>
</div>
</div>
</section>
<section id="bayley-data" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="bayley-data"><span class="header-section-number">8</span> Bayley data</h2>
<p>Loading the data from CliRes:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>Bayley0 <span class="ot">&lt;-</span> <span class="fu">read_excel_file</span>(<span class="st">"12-9-2025-Bayley_v3_P1_Data.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The tabs that we are interested in are the following:</p>
<ul>
<li><strong>CS:</strong> cognitive scale</li>
<li><strong>RC:</strong> receptive communication (language scale)</li>
<li><strong>EC:</strong> expressive communication (language scale)</li>
<li><strong>FM:</strong> fine motor (motor scale)</li>
<li><strong>GM:</strong> gross motor (motor scale)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>Bayley_tabs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CS"</span>, <span class="st">"RC"</span>, <span class="st">"EC"</span>, <span class="st">"FM"</span>, <span class="st">"GM"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s generate the data frame from these tabs:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>common_variables1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PARNO"</span>, <span class="st">"DATETESTED"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>common_variables2 <span class="ot">&lt;-</span> <span class="fu">c</span>(common_variables1, <span class="st">"SCALESCORE"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>Bayley<span class="ot">&lt;-</span> Bayley_tabs <span class="sc">|&gt;</span> </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">c</span>(common_variables2, .x)) <span class="sc">|&gt;</span> </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(Bayley_tabs) <span class="sc">|&gt;</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_vars</span>(Bayley0) <span class="sc">|&gt;</span> </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2</span>(<span class="fu">paste0</span>(<span class="st">"SCALESCORE_"</span>, Bayley_tabs), rename2, <span class="st">"SCALESCORE"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(left_join, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"PARNO"</span>, <span class="st">"DATETESTED"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"DATE"</span>), as.Date)) <span class="sc">|&gt;</span> </span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ParNo =</span> PARNO) <span class="sc">|&gt;</span> </span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(ParNo, <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(.x, <span class="st">"08RS_"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="time-points" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="time-points"><span class="header-section-number">9</span> Time points</h2>
<p>A function that generates the time points:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>make_time_points <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  children <span class="sc">|&gt;</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(ParNo, DateEnrol, DateDisc) <span class="sc">|&gt;</span> </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(x, <span class="st">"ParNo"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time_diff =</span> DateTested <span class="sc">-</span> DateEnrol,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">time1 =</span> <span class="dv">0</span>, <span class="at">time2 =</span> <span class="dv">6</span>, <span class="at">time3 =</span> <span class="dv">18</span>, <span class="co"># in months</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(<span class="fu">c</span>(time1, time2, time3), <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">abs</span>(time_diff <span class="sc">-</span> <span class="dv">30</span> <span class="sc">*</span> .x)))) <span class="sc">|&gt;</span> </span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">min_delay =</span> <span class="fu">min</span>(<span class="fu">across</span>(<span class="fu">c</span>(time1, time2, time3)))) <span class="sc">|&gt;</span> </span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time_point =</span> <span class="fu">ifelse</span>(min_delay <span class="sc">==</span> time1,</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"enrollment"</span>, <span class="fu">ifelse</span>(min_delay <span class="sc">==</span> time2,</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"6 months"</span>, <span class="st">"18 months"</span>)))</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that gets the IDs of children with duplicated assessments:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>get_IDs_with_duplicated <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">is.na</span>(time_point)) <span class="sc">|&gt;</span> </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(ParNo) <span class="sc">|&gt;</span> </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_modify</span>(<span class="sc">~</span> .x <span class="sc">|&gt;</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">group_by</span>(time_point) <span class="sc">|&gt;</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">tally</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(ParNo) <span class="sc">|&gt;</span> </span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>()</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that uses the previous two to generate the data with duplicated assessments:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>show_duplicated_assessments <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  data_with_time_points <span class="ot">&lt;-</span> <span class="fu">make_time_points</span>(x)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  IDs_with_duplicates <span class="ot">&lt;-</span> <span class="fu">get_IDs_with_duplicated</span>(data_with_time_points)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_with_time_points, ParNo <span class="sc">%in%</span> IDs_with_duplicates)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="m-abc-data-1" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="m-abc-data-1"><span class="header-section-number">9.1</span> M-ABC data</h3>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>ABC <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_duplicated_assessments</span>() <span class="sc">|&gt;</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="st">"M-ABC2.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Here all the duplicates are complete. We’ll simply keep all the earlier ones:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>ABC2 <span class="ot">&lt;-</span> ABC <span class="sc">|&gt;</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_time_points</span>() <span class="sc">|&gt;</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ParNo, time_point, min_delay) <span class="sc">|&gt;</span> </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ParNo, time_point) <span class="sc">|&gt;</span> </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> <span class="fu">head</span>(.x, <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>DateEnrol, <span class="sc">-</span>DateDisc, <span class="sc">-</span>min_delay, <span class="sc">-</span> time_diff, <span class="sc">-</span>time1, <span class="sc">-</span>time2, <span class="sc">-</span>time3) <span class="sc">|&gt;</span> </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Date_ABC =</span> DateTested)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="bayley-data-1" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="bayley-data-1"><span class="header-section-number">9.2</span> Bayley data</h3>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>Bayley <span class="ot">&lt;-</span> <span class="fu">rename</span>(Bayley, <span class="at">DateTested =</span> DATETESTED)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>Bayley <span class="sc">|&gt;</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_duplicated_assessments</span>() <span class="sc">|&gt;</span> </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="st">"Bayley2.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This shows that</p>
<ul>
<li>there is one and only one complete measurement per time point</li>
<li>the complete measurement is always the earlier one, except for patient <code>03-514</code></li>
</ul>
<p>In consequence, we decide to simply filter out all the incomplete duplicates:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>Bayley2 <span class="ot">&lt;-</span> Bayley <span class="sc">|&gt;</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_time_points</span>() <span class="sc">|&gt;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ParNo, time_point) <span class="sc">|&gt;</span> </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> {<span class="cf">if</span> (<span class="fu">nrow</span>(.x) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="fu">return</span>(<span class="fu">na.exclude</span>(.x)); .x }) <span class="sc">|&gt;</span> </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>DateEnrol, <span class="sc">-</span>DateDisc, <span class="sc">-</span>min_delay, <span class="sc">-</span> time_diff, <span class="sc">-</span>time1, <span class="sc">-</span>time2, <span class="sc">-</span>time3) <span class="sc">|&gt;</span> </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Date_Bayley =</span> DateTested)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="merging" class="level3" data-number="9.3">
<h3 data-number="9.3" class="anchored" data-anchor-id="merging"><span class="header-section-number">9.3</span> Merging</h3>
<p>Merging the M-ABC and Bayley data:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>followups <span class="ot">&lt;-</span> <span class="fu">full_join</span>(ABC2, Bayley2, <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"time_point"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="visualization" class="level3" data-number="9.4">
<h3 data-number="9.4" class="anchored" data-anchor-id="visualization"><span class="header-section-number">9.4</span> Visualization</h3>
<p>A function that prepend all the data frames of a list <code>x</code> of data frames with <code>n</code> columns of the <code>v</code> values:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>prepend_white <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n, v) {</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  nbrows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x[[<span class="dv">1</span>]])</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  white_space <span class="ot">&lt;-</span> v <span class="sc">|&gt;</span> </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(n <span class="sc">*</span> nbrows) <span class="sc">|&gt;</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span>(nbrows) <span class="sc">|&gt;</span> </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(x, <span class="sc">~</span> <span class="fu">cbind</span>(white_space, .x))</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that (i) splits the data frame <code>x</code> into a list of data frame of <code>n</code> rows (except possibly for the last slot), (ii) prepends each of these data frames with <code>wc</code> columns of 1s, and (iii) concatenate all these data frames side by side into a matrix:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>side_by_side <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n, wc) {</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>ParNo) <span class="sc">|&gt;</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split_df</span>(n) <span class="sc">|&gt;</span> </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">append_last</span>() <span class="sc">|&gt;</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prepend_white</span>(wc, <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">reduce</span>(cbind) <span class="sc">|&gt;</span> </span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>()</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of <code>image2()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>image3 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, col_no, col_yes) {</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">image2</span>(<span class="dv">0</span><span class="sc">:</span><span class="fu">ncol</span>(x), <span class="dv">0</span><span class="sc">:</span><span class="fu">nrow</span>(x), x, <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">ann =</span> <span class="cn">FALSE</span>, <span class="at">col =</span> <span class="fu">c</span>(col_no, col_yes))</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The function that plots the heatmap:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>heatmap2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">nbrow =</span> <span class="dv">45</span>, <span class="at">nb_wc =</span> <span class="dv">2</span>,</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_Bayley =</span> <span class="fu">adjustcolor</span>(<span class="st">"red"</span>, .<span class="dv">3</span>),</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_ABC    =</span> <span class="fu">adjustcolor</span>(<span class="st">"blue"</span>, .<span class="dv">3</span>),</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_NA     =</span> <span class="fu">adjustcolor</span>(<span class="st">"white"</span>, <span class="dv">0</span>),</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_lines  =</span> <span class="st">"white"</span>, <span class="at">cx =</span> .<span class="dv">5</span>) {</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting M-ABC data:</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> </span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Date_Bayley) <span class="sc">|&gt;</span> </span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time_point, <span class="at">values_from =</span> Date_ABC) <span class="sc">|&gt;</span> </span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">side_by_side</span>(nbrow, nb_wc)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">image3</span>(tmp, col_NA, col_Bayley)</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="co"># adding Bayley data:</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">new =</span> <span class="cn">TRUE</span>)</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Date_ABC) <span class="sc">|&gt;</span> </span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time_point, <span class="at">values_from =</span> Date_Bayley) <span class="sc">|&gt;</span> </span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">side_by_side</span>(nbrow, nb_wc) <span class="sc">|&gt;</span> </span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">image3</span>(col_NA, col_ABC)</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="co"># adding separation lines:</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">ncol</span>(tmp), <span class="at">col =</span> col_lines)</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span><span class="sc">:</span>nbrow, <span class="at">col =</span> col_lines)</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a><span class="co"># adding children IDs:</span></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>  ids <span class="ot">&lt;-</span> <span class="fu">str_remove</span>(<span class="fu">unique</span>(x<span class="sc">$</span>ParNo), <span class="st">"^.*-"</span>)</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ids)</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> nb_wc</span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>  ncol_tmp <span class="ot">&lt;-</span> <span class="fu">ncol</span>(tmp)</span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>  nbcol <span class="ot">&lt;-</span> ncol_tmp <span class="sc">/</span> by</span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1</span>, ncol_tmp, by), <span class="at">each =</span> nbrow)[sel]</span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>  ys <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rev</span>(<span class="dv">1</span><span class="sc">:</span>nbrow <span class="sc">-</span> .<span class="dv">5</span>), nbcol)[sel]</span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(xs, ys, ids, <span class="at">cex =</span> cx)</span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a><span class="co"># adding time points:</span></span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>  xx <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span> <span class="sc">+</span> nb_wc, ncol_tmp, by) <span class="sc">-</span> .<span class="dv">5</span></span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"e"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>), nbcol)[sel], <span class="at">at =</span> <span class="fu">sort</span>(<span class="fu">c</span>(xx, xx <span class="sc">+</span> <span class="dv">1</span>, xx <span class="sc">+</span> <span class="dv">2</span>)), <span class="at">cex =</span> cx)</span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>An overview of the M-ABC and Bayley data for all the children and the 3 time points:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">plt =</span> <span class="fu">c</span>(.<span class="dv">07</span>, .<span class="dv">97</span>, .<span class="dv">07</span>, .<span class="dv">95</span>))</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expand_grid</span>(<span class="at">ParNo      =</span> <span class="fu">unique</span>(followups<span class="sc">$</span>ParNo),</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">time_point =</span> <span class="fu">c</span>(<span class="st">"enrollment"</span>, <span class="st">"6 months"</span>, <span class="st">"18 months"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(followups, <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"time_point"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ParNo, time_point, <span class="fu">starts_with</span>(<span class="st">"Date"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Date"</span>), <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="sc">!</span> <span class="fu">is.na</span>(.x)) <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">heatmap2</span>()</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>color_codes <span class="ot">&lt;-</span> <span class="fu">rgb</span>(<span class="fu">c</span>(<span class="dv">255</span>, <span class="dv">191</span>, <span class="dv">192</span>),</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="dv">193</span>, <span class="dv">194</span>, <span class="dv">147</span>),</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="dv">193</span>, <span class="dv">255</span>, <span class="dv">213</span>), <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"m-abc"</span>, <span class="st">"bayley"</span>, <span class="st">"both"</span>), <span class="at">max =</span> <span class="dv">255</span>)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>usr <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="st">"usr"</span>)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(usr[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">mean</span>(usr[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]), usr[<span class="dv">3</span>] <span class="sc">-</span> <span class="dv">2</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"M-ABC"</span>, <span class="st">"Bayley"</span>, <span class="st">"both"</span>),</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> color_codes, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">horiz =</span> <span class="cn">TRUE</span>, <span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">xjust =</span> .<span class="dv">5</span>, <span class="at">yjust =</span> .<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_followup_data_availability-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>where blue is where the Bayley data are available, red is where the M-ABC data are available, purple is where both data are available and white is where none of the data are available.</p>
</section>
</section>
<section id="analysis" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="analysis"><span class="header-section-number">10</span> Analysis</h2>
<section id="hfmd-vs-controls" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="hfmd-vs-controls"><span class="header-section-number">10.1</span> HFMD vs controls</h3>
<p>From here we work with 2 data frames: <code>children</code> that contains the children information, and <code>followups</code> that contains the follow-up data. Note that height and weight (and consequently stunting) is missing for about 22% of children:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>children <span class="sc">|&gt;</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, age, MomEdu, Gender, stunting) <span class="sc">|&gt;</span> </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_int</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.x)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   group      age   MomEdu   Gender stunting 
       0        0        1        0        3 </code></pre>
</div>
</div>
<p>Some common code:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>adjcol <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">adjustcolor</span>(..., <span class="at">alpha =</span> .<span class="dv">3</span>)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>barplot2 <span class="ot">&lt;-</span> <span class="cf">function</span>(height, x) {</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">barplot</span>(height, <span class="at">names.arg =</span> x, <span class="at">beside =</span> <span class="cn">TRUE</span>, <span class="at">ylab =</span> <span class="st">"proportion"</span>,</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="fu">adjcol</span>(<span class="fu">rev</span>(cols)))</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>add_legend1 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">where =</span> <span class="st">"topright"</span>) {</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(where, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"HFMD"</span>), <span class="at">fill =</span> <span class="fu">adjcol</span>(<span class="fu">rev</span>(cols)), <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s look at the age distribution of the controls and HFMD cases:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> children <span class="sc">|&gt;</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(age, <span class="sc">~</span> <span class="fu">as.numeric</span>(.x) <span class="sc">/</span> <span class="dv">30</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">|&gt;</span> </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_map</span>(<span class="sc">~</span> .x <span class="sc">|&gt;</span> <span class="fu">pull</span>(age) <span class="sc">|&gt;</span> <span class="fu">density</span>(<span class="at">from =</span> <span class="dv">0</span>))</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>tmp <span class="sc">|&gt;</span> </span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> .x <span class="sc">|&gt;</span> <span class="fu">unclass</span>() <span class="sc">|&gt;</span> magrittr<span class="sc">::</span><span class="fu">extract</span>(<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> </span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(range) <span class="sc">|&gt;</span> </span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">plot</span>(<span class="cn">NA</span>, <span class="at">xlim =</span> x, <span class="at">ylim =</span> y, <span class="at">xlab =</span> <span class="st">"age (months)"</span>, <span class="at">ylab =</span> <span class="st">"density"</span>))</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>tmp <span class="sc">|&gt;</span> </span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk2</span>(cols, <span class="sc">~</span> <span class="fu">polygon</span>(<span class="fu">adding_zero_ys</span>(.x), <span class="at">col =</span> <span class="fu">adjcol</span>(.y), <span class="at">border =</span> <span class="cn">NA</span>))</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="fu">add_legend1</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_age_distribution-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="470"></p>
</figure>
</div>
</div>
</div>
<p>Let’s now look at the level of the mother’s education:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>edu_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Never been to school"</span>, <span class="st">"Attended some primary school"</span>,</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Completed primary school (5th gr)"</span>,</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Completed lower secondary school (9th gr)"</span>,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Completed higher secondary school (12th gr)"</span>,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Completed university/college degree"</span>, <span class="st">"Completed postgraduate degree"</span>)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>children <span class="sc">|&gt;</span> </span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(MomEdu, group)) <span class="sc">|&gt;</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">[</span><span class="st">`</span>(edu_order, ) <span class="sc">|&gt;</span> </span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">|&gt;</span> </span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">barplot2</span>(<span class="fu">c</span>(<span class="st">"none"</span>, <span class="st">"some"</span>, <span class="st">"5th g"</span>, <span class="st">"9th g"</span>, <span class="st">"12th g"</span>, <span class="st">"collg"</span>, <span class="st">"postg"</span>))</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="fu">add_legend1</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_mom_edu-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="470"></p>
</figure>
</div>
</div>
</div>
<p>Stunt and gender:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>children <span class="sc">|&gt;</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, Gender, stunting) <span class="sc">|&gt;</span> </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.exclude</span>() <span class="sc">|&gt;</span> </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">|&gt;</span> </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>() <span class="sc">|&gt;</span> </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> .x <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Gender, stunting) <span class="sc">|&gt;</span> <span class="fu">tally</span>() <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(left_join, <span class="fu">c</span>(<span class="st">"Gender"</span>, <span class="st">"stunting"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"n"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span> </span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">[</span><span class="st">`</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, ) <span class="sc">|&gt;</span> </span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">barplot2</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>), <span class="at">each =</span> <span class="dv">2</span>))</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"non-stunt"</span>, <span class="st">"stunt"</span>), <span class="dv">2</span>), <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">11</span>, <span class="dv">3</span>))</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a><span class="fu">add_legend1</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_sex_stunt-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="470"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="propensity-scores" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="propensity-scores"><span class="header-section-number">10.2</span> Propensity scores</h3>
<p>The covariates:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>covariables <span class="ot">&lt;-</span> <span class="fu">select</span>(children, ParNo, Gender, age, MomEdu, stunting, group)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The formula:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>ps_formula <span class="ot">&lt;-</span> group <span class="sc">~</span> Gender <span class="sc">+</span> age <span class="sc">+</span> MomEdu <span class="sc">+</span> stunting</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that generates a data set for a given response variable at a given time point:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>make_data <span class="ot">&lt;-</span> <span class="cf">function</span>(data, response, timepoint) {</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(time_point <span class="sc">==</span> timepoint) <span class="sc">|&gt;</span> </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(ParNo, <span class="fu">all_of</span>(response)) <span class="sc">|&gt;</span> </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.exclude</span>() <span class="sc">|&gt;</span> </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(covariables, <span class="st">"ParNo"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>ParNo) <span class="sc">|&gt;</span> </span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(response), group, <span class="fu">everything</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.exclude</span>()</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that prepares the follow-up data:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>prepare_fu_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> followups, <span class="at">min_nb =</span> <span class="dv">4</span>) {</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">response  =</span> <span class="fu">c</span>(<span class="st">"MD1ISS"</span>, <span class="st">"MD2ISS"</span>, <span class="st">"MD3ISS"</span>, <span class="st">"AC1ISS"</span>, <span class="st">"AC2ISS"</span>,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"BAL1ISS"</span>, <span class="st">"BAL2ISS"</span>, <span class="st">"BAL3ISS"</span>,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"CS"</span>, <span class="st">"RC"</span>, <span class="st">"EC"</span>, <span class="st">"FM"</span>, <span class="st">"GM"</span>),</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">timepoint =</span> <span class="fu">c</span>(<span class="st">"enrollment"</span>, <span class="st">"6 months"</span>, <span class="st">"18 months"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dataset =</span> <span class="fu">map2</span>(response, timepoint, <span class="sc">~</span> <span class="fu">make_data</span>(data, .x, .y)),</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">ctable  =</span> <span class="fu">map</span>(dataset, <span class="sc">~</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(.x<span class="sc">$</span>group)))) <span class="sc">|&gt;</span> </span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">map_lgl</span>(ctable, <span class="sc">~</span> <span class="fu">length</span>(.x) <span class="sc">&gt;</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ctable =</span> <span class="fu">map</span>(ctable, <span class="sc">~</span> <span class="fu">setNames</span>(.x, <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"HFMD"</span>)))) <span class="sc">|&gt;</span> </span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(ctable) <span class="sc">|&gt;</span> </span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(HFMD <span class="sc">&gt;</span> min_nb)</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that generates weights from a logistic regression:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>logistic_ps <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(group, <span class="sc">~</span> .x <span class="sc">==</span> <span class="st">"HFMD"</span>),</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">weights =</span> ps_formula <span class="sc">|&gt;</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">glm</span>(binomial, <span class="at">data =</span> <span class="fu">pick</span>(<span class="fu">everything</span>())) <span class="sc">|&gt;</span> </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(<span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>             { <span class="fu">ifelse</span>(group, <span class="dv">1</span>, . <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .)) }) <span class="sc">|&gt;</span> </span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(weights)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that generates weights from the <code>twang</code> package:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>twang_ps <span class="ot">&lt;-</span> <span class="cf">function</span>(data, ...) {</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(group, <span class="sc">~</span> <span class="fu">as.integer</span>(group <span class="sc">==</span> <span class="st">"HFMD"</span>)),</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.character</span>(.x) <span class="sc">|</span> <span class="fu">is.logical</span>(.x)), as.factor),</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(age, as.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ps</span>(ps_formula, <span class="at">data =</span> _, <span class="at">estimand =</span> <span class="st">"ATT"</span>, <span class="at">stop.method =</span> <span class="st">"es.mean"</span>,</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">verbose =</span> <span class="cn">FALSE</span>, ...) <span class="sc">|&gt;</span> </span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get.weights</span>(<span class="st">"es.mean"</span>)  </span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that computes the TMLE:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>default_libs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.glmnet"</span>, <span class="st">"SL.mean"</span>, <span class="st">"SL.gam"</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>tmle2 <span class="ot">&lt;-</span> <span class="cf">function</span>(data, response, <span class="at">family =</span> <span class="st">"gaussian"</span>,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Qlib =</span> default_libs, <span class="at">glib =</span> default_libs, ...) {</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Gender, age, MomEdu, stunting) <span class="sc">|&gt;</span> </span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.character</span>(.x) <span class="sc">|</span> <span class="fu">is.logical</span>(.x)), as.factor),</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(age, as.numeric)) <span class="sc">|&gt;</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tmle</span>(data[[response]], <span class="fu">as.integer</span>(data<span class="sc">$</span>group <span class="sc">==</span> <span class="st">"HFMD"</span>), <span class="at">W =</span> _, <span class="at">family =</span> family,</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Q.SL.library =</span> Qlib, <span class="at">g.SL.library =</span> glib) <span class="sc">|&gt;</span> </span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mextract2</span>(<span class="fu">c</span>(<span class="st">"estimates"</span>, <span class="st">"ATT"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mextract</span>(<span class="fu">c</span>(<span class="st">"psi"</span>, <span class="st">"CI"</span>, <span class="st">"pvalue"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>() <span class="sc">|&gt;</span> </span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"cf_tm"</span>, <span class="st">"2.5 %tm"</span>, <span class="st">"97.5 %tm"</span>, <span class="st">"p_tm"</span>))</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that computes balance statistics for diagnostic of the propensity scores:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>bal_tab <span class="ot">&lt;-</span> <span class="cf">function</span>(data, w) {</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(group, <span class="sc">~</span> .x <span class="sc">==</span> <span class="st">"HFMD"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bal.tab</span>(ps_formula, <span class="at">data =</span> _, <span class="at">weights =</span> w, <span class="at">s.d.denom =</span> <span class="st">"treated"</span>)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that retrieve the balance adjustments for diagnostic of the propensity scores:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>get_diff <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">$</span>Balance<span class="sc">$</span>Diff.Adj</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that produce the maximum values of the balance adjustments for diagnostic of the propensity scores:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>get_max_diff <span class="ot">&lt;-</span> <span class="cf">function</span>(data, w) {</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bal_tab</span>(w) <span class="sc">|&gt;</span> </span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_diff</span>() <span class="sc">|&gt;</span> </span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>()</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that generate the formula of the model with the response <code>y</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>reformulate2 <span class="ot">&lt;-</span> <span class="cf">function</span>(y) {</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reformulate</span>(<span class="fu">c</span>(<span class="st">"Gender"</span>, <span class="st">"age"</span>, <span class="st">"MomEdu"</span>, <span class="st">"stunting"</span>, <span class="st">"group"</span>), y)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that processes the output of a model in the <code>pipeline()</code> function that follows:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>process_model <span class="ot">&lt;-</span> <span class="cf">function</span>(x, model, nm) {</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">"cf_"</span>, nm) <span class="sc">:</span><span class="er">=</span> <span class="fu">map_dbl</span>({{ model }}, coef2),</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">ci                   =</span> <span class="fu">map</span>({{ model }}, confint2)) <span class="sc">|&gt;</span>   </span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(ci) <span class="sc">|&gt;</span> </span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(.x, nm), <span class="fu">ends_with</span>(<span class="st">"%"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">"p_"</span>, nm) <span class="sc">:</span><span class="er">=</span> <span class="fu">map_dbl</span>({{ model}}, get_p))</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The pipeline:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>pipeline <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> followups, <span class="at">min_nb =</span> <span class="dv">4</span>) {</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prepare_fu_data</span>(min_nb) <span class="sc">|&gt;</span> </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dataset =</span> <span class="fu">map</span>(dataset,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">~</span> <span class="fu">mutate</span>(.x, <span class="at">ow =</span> <span class="fu">logistic_ps</span>(<span class="fu">pick</span>(<span class="fu">everything</span>())),</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">tw =</span> <span class="fu">twang_ps</span>(<span class="fu">pick</span>(<span class="fu">everything</span>())),</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">t2 =</span> <span class="fu">twang_ps</span>(<span class="fu">pick</span>(<span class="fu">everything</span>()),</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">n.trees =</span> <span class="dv">5000</span>,</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">interaction.depth =</span> <span class="dv">2</span>))),</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">formula =</span> <span class="fu">map</span>(response, <span class="sc">~</span> <span class="fu">reformulate</span>(<span class="st">"group"</span>, .x)),</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">glm0 =</span> <span class="fu">map2</span>(formula,  dataset, <span class="sc">~</span> <span class="fu">glm</span>(.x, <span class="at">data =</span> .y)),</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">glm1 =</span> <span class="fu">map2</span>(response, dataset, <span class="sc">~</span> <span class="fu">glm</span>(<span class="fu">reformulate2</span>(.x), <span class="at">data =</span> .y)),</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">m_ow =</span> <span class="fu">map2</span>(formula,  dataset, <span class="sc">~</span> <span class="fu">svyglm2</span>(.x, .y, <span class="sc">~</span>ow)),</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">m_tw =</span> <span class="fu">map2</span>(formula,  dataset, <span class="sc">~</span> <span class="fu">svyglm2</span>(.x, .y, <span class="sc">~</span>tw)),</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">m_t2 =</span> <span class="fu">map2</span>(formula,  dataset, <span class="sc">~</span> <span class="fu">svyglm2</span>(.x, .y, <span class="sc">~</span>t2))) <span class="sc">|&gt;</span> </span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process_model</span>(glm0, <span class="st">"l0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process_model</span>(glm1, <span class="st">"l1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process_model</span>(m_ow, <span class="st">"ow"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process_model</span>(m_tw, <span class="st">"tw"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process_model</span>(m_t2, <span class="st">"t2"</span>) <span class="co">#|&gt; </span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 - TMLE:           </span></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a><span class="co">#    mutate(tmle = map2_dfr(dataset, response, tmle2)) |&gt; </span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a><span class="co">#    unnest_wider(tmle)</span></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that computes the diagnostic metrics for a dataset <code>x</code> and for the propensity score weight <code>psw</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>diagnostic_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(x, psw) {</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x[[psw]]</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">max =</span> max,</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">mea =</span> mean,</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">med =</span> median,</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ess =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfc</span>(<span class="sc">~</span> <span class="fu">.x</span>(y)) <span class="sc">|&gt;</span> </span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dif =</span> <span class="fu">abs</span>(mea <span class="sc">-</span> med),</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">bal =</span> <span class="fu">get_max_diff</span>(x, psw))</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(y) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(psw, <span class="st">"_"</span>, <span class="fu">names</span>(y))</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>  y</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that runs <code>diagnostic_metrics()</code> on all the datasets of an output <code>x</code> of the <code>pipeline()</code> function, and for the propensity score weight <code>psw</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>diagnostic_ps <span class="ot">&lt;-</span> <span class="cf">function</span>(x, psw) {</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(response, timepoint, control, HFMD, dataset) <span class="sc">|&gt;</span> </span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">diag =</span> <span class="fu">map</span>(dataset, diagnostic_metrics, psw)) <span class="sc">|&gt;</span> </span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(diag) <span class="sc">|&gt;</span> </span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">n =</span> control <span class="sc">+</span> HFMD) <span class="sc">|&gt;</span> </span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(dataset, control, HFMD))</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Running the pipeline (takes 2’):</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">pipeline</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s compare the p values:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>output <span class="sc">|&gt;</span> </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(response, timepoint, control, HFMD, <span class="fu">starts_with</span>(<span class="st">"p_"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"p"</span>), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="dv">3</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31 × 9
   response timepoint  control  HFMD  p_l0  p_l1  p_ow  p_tw  p_t2
   &lt;chr&gt;    &lt;chr&gt;        &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 MD1ISS   6 months        47     6 0.398 0.3   0.454 0.735 0.574
 2 MD1ISS   18 months       69    45 0.059 0.296 0.104 0.043 0.047
 3 MD2ISS   6 months        47     6 0.093 0.256 0.209 0.129 0.161
 4 MD2ISS   18 months       69    44 0.282 0.189 0.534 0.265 0.215
 5 MD3ISS   6 months        47     6 0.018 0.06  0.111 0.266 0.166
 6 MD3ISS   18 months       69    45 0.019 0.435 0.853 0.99  0.971
 7 AC1ISS   6 months        47     6 0.717 0.022 0.042 0.216 0.195
 8 AC1ISS   18 months       69    43 0.308 0.196 0.76  0.642 0.979
 9 AC2ISS   6 months        47     6 0.392 0.349 0.034 0.035 0.069
10 AC2ISS   18 months       69    42 0.659 0.439 0.317 0.502 0.268
11 BAL1ISS  6 months        47     6 0.144 0.064 0.06  0.017 0.033
12 BAL1ISS  18 months       69    42 0.36  0.42  0.363 0.099 0.041
13 BAL2ISS  6 months        47     6 0.159 0.396 0.401 0.14  0.225
14 BAL2ISS  18 months       69    41 0.989 0.581 0.941 0.814 0.439
15 BAL3ISS  6 months        47     6 0.01  0.453 0.143 0.199 0.174
16 BAL3ISS  18 months       67    42 0.002 0.532 0.01  0.379 0.222
17 CS       enrollment     248   218 0.26  0     0.137 0.42  0.458
18 CS       6 months       202   197 0.181 0.085 0.77  0.891 0.998
19 CS       18 months      161   149 0.027 0.124 0.958 0.825 0.832
20 RC       enrollment     248   217 0.241 0.19  0.538 0.974 0.982
21 RC       6 months       202   195 0.502 0.335 0.89  0.936 0.934
22 RC       18 months      161   149 0.112 0.222 0.893 0.863 0.839
23 EC       enrollment     248   218 0.641 0.715 0.949 0.783 0.855
24 EC       6 months       201   195 0.236 0.11  0.844 0.949 0.966
25 EC       18 months      161   148 0.031 0.029 0.705 0.766 0.784
26 FM       enrollment     248   218 0.607 0.009 0.373 0.575 0.652
27 FM       6 months       202   196 0.215 0.638 0.946 0.857 0.757
28 FM       18 months      161   149 0.01  0.018 0.928 0.761 0.77 
29 GM       enrollment     248   216 0.067 0     0.06  0.877 0.87 
30 GM       6 months       201   197 0.038 0.049 0.614 0.538 0.447
31 GM       18 months      161   148 0.08  0.758 0.509 0.627 0.713</code></pre>
</div>
</div>
<p>Let’s look at the estimates:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>output <span class="sc">|&gt;</span> </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(response, timepoint, control, HFMD, <span class="fu">starts_with</span>(<span class="st">"cf"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"cf"</span>), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="dv">2</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31 × 9
   response timepoint  control  HFMD cf_l0 cf_l1 cf_ow cf_tw cf_t2
   &lt;chr&gt;    &lt;chr&gt;        &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 MD1ISS   6 months        47     6 -0.92 -1.25 -0.88 -0.37 -0.62
 2 MD1ISS   18 months       69    45 -0.97 -0.72 -1.32 -1.41 -1.34
 3 MD2ISS   6 months        47     6 -1.48 -1.36 -1    -1.4  -1.16
 4 MD2ISS   18 months       69    44 -0.55 -0.94 -0.46 -0.72 -0.8 
 5 MD3ISS   6 months        47     6 -3.71 -3.8  -3.59 -2.2  -2.81
 6 MD3ISS   18 months       69    45 -1.58 -0.66  0.36 -0.02 -0.05
 7 AC1ISS   6 months        47     6  0.5   3.76  3.83  2.35  2.45
 8 AC1ISS   18 months       69    43  0.62  1.11 -0.39 -0.53  0.02
 9 AC2ISS   6 months        47     6 -1.06 -1.5  -3.82 -3.5  -3.02
10 AC2ISS   18 months       69    42  0.26  0.67 -1.53 -0.91 -1.61
11 BAL1ISS  6 months        47     6 -2.01 -3.55 -3.81 -4    -3.62
12 BAL1ISS  18 months       69    42 -0.55 -0.68 -0.99 -1.98 -2.18
13 BAL2ISS  6 months        47     6 -1.96 -1.53 -3.15 -4.12 -3.53
14 BAL2ISS  18 months       69    41  0.01  0.46  0.1   0.28 -0.74
15 BAL3ISS  6 months        47     6 -3.2  -1.16 -2.96 -2.47 -2.61
16 BAL3ISS  18 months       67    42 -2.17 -0.57 -2.43 -1.04 -1.36
17 CS       enrollment     248   218  1.45  2.15  2.05  1.03  0.92
18 CS       6 months       202   197  1.37  0.8   0.33 -0.14  0   
19 CS       18 months      161   149  1.54  0.7  -0.04 -0.16 -0.16
20 RC       enrollment     248   217 -0.97 -0.47 -0.52  0.03 -0.02
21 RC       6 months       202   195  0.59  0.42 -0.14  0.08  0.08
22 RC       18 months      161   149  1.09  0.58  0.1   0.12  0.15
23 EC       enrollment     248   218 -0.46  0.16 -0.06  0.27  0.18
24 EC       6 months       201   195  1.19  0.83  0.22  0.08 -0.05
25 EC       18 months      161   148  1.31  0.97  0.25  0.2   0.19
26 FM       enrollment     248   218  0.43  0.79  0.81  0.42  0.33
27 FM       6 months       202   196  0.9   0.14 -0.06  0.12  0.22
28 FM       18 months      161   149  1.69  0.85  0.06  0.21  0.2 
29 GM       enrollment     248   216  2.16  2.56  2.38  0.17  0.18
30 GM       6 months       201   197  1.55  0.74  0.43 -0.42 -0.56
31 GM       18 months      161   148  0.82  0.11 -0.33 -0.27 -0.22</code></pre>
</div>
</div>
<p>Computing the diagnostic metrics for all the propensity score weights:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"ow"</span>, <span class="st">"tw"</span>, <span class="st">"t2"</span>) <span class="sc">|&gt;</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(diagnostic_ps, <span class="at">x =</span> output) <span class="sc">|&gt;</span> </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk</span>(print, <span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31 × 9
   response timepoint  ow_max ow_mea   ow_med ow_ess ow_dif ow_bal     n
   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
 1 MD1ISS   6 months     1.91  0.191 5.89e-10   8.47 0.191  0.167     53
 2 MD1ISS   18 months   10.9   0.816 3.64e- 1  22.2  0.452  0.0952   114
 3 MD2ISS   6 months     1.91  0.191 5.89e-10   8.47 0.191  0.167     53
 4 MD2ISS   18 months   10.4   0.785 3.34e- 1  22.9  0.451  0.0866   113
 5 MD3ISS   6 months     1.91  0.191 5.89e-10   8.47 0.191  0.167     53
 6 MD3ISS   18 months   10.9   0.816 3.64e- 1  22.2  0.452  0.0952   114
 7 AC1ISS   6 months     1.91  0.191 5.89e-10   8.47 0.191  0.167     53
 8 AC1ISS   18 months    9.98  0.775 3.10e- 1  23.1  0.465  0.0852   112
 9 AC2ISS   6 months     1.91  0.191 5.89e-10   8.47 0.191  0.167     53
10 AC2ISS   18 months    9.39  0.765 2.55e- 1  22.5  0.510  0.113    111
11 BAL1ISS  6 months     1.91  0.191 5.89e-10   8.47 0.191  0.167     53
12 BAL1ISS  18 months    9.39  0.765 2.55e- 1  22.5  0.510  0.113    111
13 BAL2ISS  6 months     1.91  0.191 5.89e-10   8.47 0.191  0.167     53
14 BAL2ISS  18 months    9.11  0.753 2.54e- 1  22.7  0.499  0.113    110
15 BAL3ISS  6 months     1.91  0.191 5.89e-10   8.47 0.191  0.167     53
16 BAL3ISS  18 months   11.6   0.751 2.71e- 1  19.9  0.480  0.196    109
17 CS       enrollment   1.89  0.904 1   e+ 0 403.   0.0961 0.0596   466
18 CS       6 months     2.55  0.939 1   e+ 0 334.   0.0605 0.0609   399
19 CS       18 months    3.05  0.927 1   e+ 0 261.   0.0727 0.0738   310
20 RC       enrollment   1.89  0.901 1   e+ 0 401.   0.0986 0.0599   465
21 RC       6 months     2.54  0.937 1   e+ 0 332.   0.0632 0.0615   397
22 RC       18 months    3.05  0.927 1   e+ 0 261.   0.0727 0.0738   310
23 EC       enrollment   1.89  0.904 1   e+ 0 403.   0.0961 0.0596   466
24 EC       6 months     2.54  0.939 1   e+ 0 331.   0.0609 0.0615   396
25 EC       18 months    3.03  0.923 1   e+ 0 261.   0.0766 0.0743   309
26 FM       enrollment   1.89  0.904 1   e+ 0 403.   0.0961 0.0596   466
27 FM       6 months     2.54  0.937 1   e+ 0 333.   0.0630 0.0612   398
28 FM       18 months    3.05  0.927 1   e+ 0 261.   0.0727 0.0738   310
29 GM       enrollment   1.90  0.899 1   e+ 0 400.   0.101  0.0602   464
30 GM       6 months     2.55  0.942 1   e+ 0 334.   0.0582 0.0609   398
31 GM       18 months    3.03  0.923 1   e+ 0 261.   0.0766 0.0743   309
# A tibble: 31 × 9
   response timepoint  tw_max tw_mea  tw_med tw_ess tw_dif tw_bal     n
   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
 1 MD1ISS   6 months     1.04  0.156 0.00534   9.41  0.150 0.209     53
 2 MD1ISS   18 months    4.47  0.599 0.391    50.1   0.208 0.0948   114
 3 MD2ISS   6 months     1.04  0.156 0.00534   9.41  0.150 0.209     53
 4 MD2ISS   18 months    4.22  0.591 0.330    48.7   0.261 0.108    113
 5 MD3ISS   6 months     1.04  0.156 0.00534   9.41  0.150 0.209     53
 6 MD3ISS   18 months    4.47  0.599 0.391    50.1   0.208 0.0948   114
 7 AC1ISS   6 months     1.04  0.156 0.00534   9.41  0.150 0.209     53
 8 AC1ISS   18 months    1     0.386 0.00345  43.4   0.382 0.107    112
 9 AC2ISS   6 months     1.04  0.156 0.00534   9.41  0.150 0.209     53
10 AC2ISS   18 months    1     0.386 0.0171   43.7   0.369 0.110    111
11 BAL1ISS  6 months     1.04  0.156 0.00534   9.41  0.150 0.209     53
12 BAL1ISS  18 months    1     0.386 0.0171   43.7   0.369 0.110    111
13 BAL2ISS  6 months     1.04  0.156 0.00534   9.41  0.150 0.209     53
14 BAL2ISS  18 months    4.48  0.569 0.345    46.3   0.224 0.0918   110
15 BAL3ISS  6 months     1.04  0.156 0.00534   9.41  0.150 0.209     53
16 BAL3ISS  18 months    1     0.418 0.0404   48.2   0.377 0.0871   109
17 CS       enrollment   6.01  0.825 1       321.    0.175 0.0726   466
18 CS       6 months     3.48  0.885 1       309.    0.115 0.0609   399
19 CS       18 months    3.41  0.862 1       241.    0.138 0.0738   310
20 RC       enrollment   4.73  0.840 1       342.    0.160 0.0636   465
21 RC       6 months     3.30  0.876 1       305.    0.124 0.0615   397
22 RC       18 months    3.41  0.862 1       241.    0.138 0.0738   310
23 EC       enrollment   6.01  0.825 1       321.    0.175 0.0726   466
24 EC       6 months     3.71  0.872 1       295.    0.128 0.0615   396
25 EC       18 months    3.28  0.860 1       241.    0.140 0.0743   309
26 FM       enrollment   6.01  0.825 1       321.    0.175 0.0726   466
27 FM       6 months     3.36  0.880 1       308.    0.120 0.0612   398
28 FM       18 months    3.41  0.862 1       241.    0.138 0.0738   310
29 GM       enrollment   6.24  0.824 1       315.    0.176 0.0711   464
30 GM       6 months     3.50  0.884 1       307.    0.116 0.0609   398
31 GM       18 months    3.28  0.860 1       241.    0.140 0.0743   309
# A tibble: 31 × 9
   response timepoint  t2_max t2_mea t2_med t2_ess t2_dif t2_bal     n
   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
 1 MD1ISS   6 months     1.45  0.179 0.0192   10.5  0.160 0.167     53
 2 MD1ISS   18 months    5.09  0.601 0.385    49.0  0.216 0.0914   114
 3 MD2ISS   6 months     1.45  0.179 0.0192   10.5  0.160 0.167     53
 4 MD2ISS   18 months    5.34  0.600 0.361    45.8  0.239 0.0883   113
 5 MD3ISS   6 months     1.45  0.179 0.0192   10.5  0.160 0.167     53
 6 MD3ISS   18 months    5.09  0.601 0.385    49.0  0.216 0.0914   114
 7 AC1ISS   6 months     1.45  0.179 0.0192   10.5  0.160 0.167     53
 8 AC1ISS   18 months    5.12  0.590 0.339    46.6  0.252 0.0904   112
 9 AC2ISS   6 months     1.45  0.179 0.0192   10.5  0.160 0.167     53
10 AC2ISS   18 months    1     0.413 0.0721   48.7  0.341 0.133    111
11 BAL1ISS  6 months     1.45  0.179 0.0192   10.5  0.160 0.167     53
12 BAL1ISS  18 months    1     0.413 0.0721   48.7  0.341 0.133    111
13 BAL2ISS  6 months     1.45  0.179 0.0192   10.5  0.160 0.167     53
14 BAL2ISS  18 months    1     0.407 0.0658   47.8  0.342 0.137    110
15 BAL3ISS  6 months     1.45  0.179 0.0192   10.5  0.160 0.167     53
16 BAL3ISS  18 months    1     0.416 0.0461   47.9  0.370 0.0758   109
17 CS       enrollment   4.99  0.852 1       332.   0.148 0.0596   466
18 CS       6 months     6.44  0.862 1       252.   0.138 0.0609   399
19 CS       18 months    3.31  0.871 1       235.   0.129 0.0738   310
20 RC       enrollment   4.99  0.852 1       333.   0.148 0.0599   465
21 RC       6 months     3.34  0.895 1       306.   0.105 0.0615   397
22 RC       18 months    3.31  0.871 1       235.   0.129 0.0738   310
23 EC       enrollment   4.99  0.852 1       332.   0.148 0.0596   466
24 EC       6 months     3.34  0.896 1       303.   0.104 0.0615   396
25 EC       18 months    3.29  0.868 1       235.   0.132 0.0743   309
26 FM       enrollment   4.99  0.852 1       332.   0.148 0.0596   466
27 FM       6 months     7.69  0.842 1       235.   0.158 0.0612   398
28 FM       18 months    3.31  0.871 1       235.   0.129 0.0738   310
29 GM       enrollment   4.71  0.853 1       336.   0.147 0.0602   464
30 GM       6 months     5.53  0.874 1       267.   0.126 0.0609   398
31 GM       18 months    3.29  0.868 1       235.   0.132 0.0743   309</code></pre>
</div>
</div>
<p><strong>Interpretations:</strong></p>
<ul>
<li>covariates balance &lt; 0.1 is good. Values between 0.1 and 0.2 are indicative of moderate imbalance. Values above 0.2 are a problem.</li>
<li>weights should not be too high.</li>
<li>weights distribution should not be too heavy right tail.</li>
<li>mean an median of weights should not be too different.</li>
<li>effective sample size should not be too different from real sample size (not less than 50% of original sample size).</li>
<li>effective sample size should not be lower than the number treated.</li>
<li>max weight should not be much higher than 10 to 20 times the median weight.</li>
</ul>
</section>
<section id="responses" class="level3" data-number="10.3">
<h3 data-number="10.3" class="anchored" data-anchor-id="responses"><span class="header-section-number">10.3</span> Responses</h3>
<p>A function that plots the density of the response for a given data set (where the response is the first variable of input <code>x</code> data frame):</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>plot_density1 <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, response, timepoint) {</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">density2</span>() <span class="sc">|&gt;</span> </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>    (\(x) {</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(x, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="fu">paste</span>(response, <span class="st">"score"</span>), <span class="at">ylab =</span> <span class="st">"density"</span>)</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">polygon2</span>(x, <span class="at">col =</span> <span class="dv">4</span>)</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>    })()</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(timepoint, <span class="at">cex =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The same function as above but with a histogram:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>plot_histogram1 <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, response, timepoint) {</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span> </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist2</span>(<span class="at">col =</span> <span class="dv">4</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">main =</span> <span class="cn">NA</span>,</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="fu">paste</span>(response, <span class="st">"score"</span>), <span class="at">ylab =</span> <span class="st">"probability"</span>)</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(timepoint, <span class="at">cex =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This function splits the response (i.e.&nbsp;first variable) of the <code>x</code> data frame into control and disease:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>split2control_disease <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"HFMD"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="sc">~</span> x <span class="sc">|&gt;</span> <span class="fu">filter</span>(group <span class="sc">==</span> .x) <span class="sc">|&gt;</span> <span class="fu">pull</span>(<span class="dv">1</span>))</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This function does the same as <code>plot_density1()</code> but for the control and infected separately:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>plot_density2 <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, response, timepoint) {</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span> </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split2control_disease</span>() <span class="sc">|&gt;</span> </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(density2) <span class="sc">|&gt;</span> </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>    (\(x) {</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(<span class="cn">NA</span>, <span class="at">xlim =</span> <span class="fu">range2</span>(x, <span class="st">"x"</span>), <span class="at">ylim =</span> <span class="fu">range2</span>(x, <span class="st">"y"</span>),</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab =</span> <span class="fu">paste</span>(response, <span class="st">"score"</span>), <span class="at">ylab =</span> <span class="st">"density"</span>)</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">walk2</span>(x, <span class="fu">adjustcolor</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>), .<span class="dv">2</span>), <span class="sc">~</span> <span class="fu">polygon2</span>(.x, <span class="at">col =</span> .y))</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>    })()</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(timepoint, <span class="at">cex =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The histogram version:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>plot_histogram2 <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, response, timepoint) {</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span> </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split2control_disease</span>() <span class="sc">|&gt;</span> </span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(hist2, <span class="at">plot =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>    (\(x) {</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(<span class="cn">NA</span>, <span class="at">xlim =</span> <span class="fu">range2</span>(x, <span class="st">"breaks"</span>), <span class="at">ylim =</span> <span class="fu">range2</span>(x, <span class="st">"density"</span>),</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab =</span> <span class="fu">paste</span>(response, <span class="st">"score"</span>), <span class="at">ylab =</span> <span class="st">"probability"</span>)</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">walk2</span>(x, <span class="fu">adjustcolor</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>), .<span class="dv">2</span>),</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span> <span class="fu">plot</span>(.x, <span class="at">col =</span> .y, <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>))</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>    })()</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(timepoint, <span class="at">cex =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s look at the distribution of the responses:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">4</span>), <span class="at">plt =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">97</span>, .<span class="dv">27</span>, .<span class="dv">87</span>))</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>output <span class="sc">|&gt;</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dataset, response, timepoint) <span class="sc">|&gt;</span> </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pwalk</span>(plot_density1)</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_responses_distribution1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The histogram version:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">4</span>), <span class="at">plt =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">97</span>, .<span class="dv">27</span>, .<span class="dv">87</span>))</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>output <span class="sc">|&gt;</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dataset, response, timepoint) <span class="sc">|&gt;</span> </span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pwalk</span>(plot_histogram1)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_responses_distribution1h-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s look at the distribution of the responses, distinguishing control (in blue) and infected patients (red):</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">4</span>), <span class="at">plt =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">97</span>, .<span class="dv">27</span>, .<span class="dv">87</span>))</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>output <span class="sc">|&gt;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dataset, response, timepoint) <span class="sc">|&gt;</span> </span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pwalk</span>(plot_density2)</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span>, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">ann =</span> <span class="cn">FALSE</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="fu">add_legend1</span>(<span class="st">"center"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_responses_distribution2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The histogram version:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">4</span>), <span class="at">plt =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">97</span>, .<span class="dv">27</span>, .<span class="dv">87</span>))</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>output <span class="sc">|&gt;</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dataset, response, timepoint) <span class="sc">|&gt;</span> </span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pwalk</span>(plot_histogram2)</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span>, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">ann =</span> <span class="cn">FALSE</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="fu">add_legend1</span>(<span class="st">"center"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_responses_distribution2h-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="plotting-effects" class="level3" data-number="10.4">
<h3 data-number="10.4" class="anchored" data-anchor-id="plotting-effects"><span class="header-section-number">10.4</span> Plotting effects</h3>
<p>The methods and their color code:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>methods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"l0"</span>, <span class="st">"l1"</span>, <span class="st">"ow"</span>, <span class="st">"tw"</span>, <span class="st">"t2"</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="fu">length</span>(methods), <span class="st">"Set1"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The time points:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>timepoints <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"enrollment"</span>, <span class="st">"6 months"</span>, <span class="st">"18 months"</span>)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>template <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">timepoint =</span> timepoints)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that prepares the data:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>prepare_data <span class="ot">&lt;-</span> <span class="cf">function</span>(method, data) {</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(timepoint, <span class="fu">ends_with</span>(method), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">"p"</span>, <span class="st">"m"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(template, <span class="at">y =</span> _, <span class="st">"timepoint"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"timepoint"</span>, <span class="st">"y"</span>, <span class="st">"l"</span>, <span class="st">"u"</span>, <span class="st">"x"</span>))</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that plots the effect for 1 score, for the 3 time points and the 5 methods:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>plot_effects <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map2</span>(<span class="fu">seq</span>(<span class="sc">-</span>.<span class="dv">2</span>, .<span class="dv">2</span>, .<span class="dv">1</span>), <span class="sc">~</span> <span class="fu">mutate</span>(.x, <span class="at">x =</span> x <span class="sc">+</span> .y)) <span class="sc">|&gt;</span> </span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map2</span>(cols, <span class="sc">~</span> <span class="fu">mutate</span>(.x, <span class="at">col =</span> .y)) <span class="sc">|&gt;</span> </span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> </span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with</span>({</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(x, y, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(l, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">max</span>(u, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), <span class="at">col =</span> col,</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="cn">NA</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">ylab =</span> <span class="st">"effect of disease on score"</span>)</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrows</span>(x, l, x, u, .<span class="dv">03</span>, <span class="dv">90</span>, <span class="dv">3</span>, col)</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that combines <code>prepare_data()</code> and <code>plot_effects()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>plot_1_variable <span class="ot">&lt;-</span> <span class="cf">function</span>(var, data) {</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  methods <span class="sc">|&gt;</span> </span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(prepare_data, <span class="fu">filter</span>(data, response <span class="sc">==</span> var)) <span class="sc">|&gt;</span> </span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_effects</span>()</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext2</span>(<span class="fu">paste</span>(var, <span class="st">"score"</span>))</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext2</span>(timepoints, <span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq_along</span>(timepoints))</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The function that plots the effects for all the scores, for all time points and methods:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>plot_effects_all <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="dv">1</span>, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">ann =</span> <span class="cn">FALSE</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">col =</span> cols, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">bty =</span> <span class="st">"n"</span>,</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"no correction"</span>, <span class="st">"multivariate model"</span>, <span class="st">"PS by logistic regression"</span>,</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"PS by gradient boosting, default"</span>,</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"PS by gradient boosting, Saras'"</span>))</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(response) <span class="sc">|&gt;</span> </span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">walk</span>(plot_1_variable, x)</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s plot the effect for all the score, time points and methods:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>), <span class="at">plt =</span> <span class="fu">c</span>(.<span class="dv">15</span>, .<span class="dv">97</span>, .<span class="dv">15</span>, .<span class="dv">9</span>))</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_effects_all</span>(output)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(1, type = "n", ann = FALSE, axes = FALSE)</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co">#legend("topleft", col = cols, lwd = 1, pch = 19, bty = "n",</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co">#       legend = c("no correction", "multivariate model", "PS by logistic regression",</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                  "PS by gradient boosting, default",</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                  "PS by gradient boosting, Saras'"))</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a><span class="co">#output |&gt; </span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  pull(response) |&gt; </span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  unique() |&gt; </span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a><span class="co">#  walk(plot_1_variable, output)</span></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_Bayley-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="ev-a71-and-severe-cases" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="ev-a71-and-severe-cases"><span class="header-section-number">11</span> EV-A71 and severe cases</h2>
<p>The various PCR results:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(children<span class="sc">$</span>PCR))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "CV-A10"        "CV-A12"        "CV-A16"        "CV-A2"        
 [5] "CV-A4"         "CV-A6"         "CV-A8"         "CV-A8/EV-A71" 
 [9] "CV-B1"         "CV-B4"         "CV-B5"         "E-11"         
[13] "E-14"          "E-30"          "E-9"           "EV"           
[17] "EV-A71"        "EV-A71 B5"     "EV-A71/ RhiA"  "EV-A71/CV A24"
[21] "EV-A71/CV-A6"  "EV-A71/RhiA"   "EV-C96"        "neg"          
[25] "PV2"           "RhiA"         </code></pre>
</div>
</div>
<p>Severity vs EV71:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>children <span class="sc">|&gt;</span> </span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"HFMD"</span>) <span class="sc">|&gt;</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EV71 =</span> <span class="fu">str_detect</span>(PCR, <span class="st">"EV-A71"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(HFMD, EV71))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                EV71
HFMD             FALSE TRUE
  grade 2a          78    9
  grade 2b(1)       45    7
  grade 2b(2)        4    2
  grade 3            9   18
  grade 4            1    1
  Not Applicable    49    4</code></pre>
</div>
</div>
<p>A function that filters the patients in the <code>followups</code> data frame according to some rules on the variables on the <code>children</code> data frame:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>filter_patients <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> children <span class="sc">|&gt;</span> </span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(...) <span class="sc">|&gt;</span> </span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(ParNo)</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(followups, ParNo <span class="sc">%in%</span> sel)</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="severe-cases" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="severe-cases"><span class="header-section-number">11.1</span> Severe cases</h3>
<p>Running the pipeline on the severe cases only:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>output_sev <span class="ot">&lt;-</span> <span class="fu">filter_patients</span>(group <span class="sc">==</span> <span class="st">"control"</span> <span class="sc">|</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>                                <span class="sc">!</span>(HFMD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"grade 2a"</span>, <span class="st">"Not Applicable"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pipeline</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The number of data points:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>output_sev <span class="sc">|&gt;</span> </span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(response, timepoint, control, HFMD) <span class="sc">|&gt;</span> </span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 23 × 4
   response timepoint  control  HFMD
   &lt;chr&gt;    &lt;chr&gt;        &lt;int&gt; &lt;int&gt;
 1 MD1ISS   18 months       69    21
 2 MD2ISS   18 months       69    20
 3 MD3ISS   18 months       69    21
 4 AC1ISS   18 months       69    20
 5 AC2ISS   18 months       69    19
 6 BAL1ISS  18 months       69    19
 7 BAL2ISS  18 months       69    18
 8 BAL3ISS  18 months       67    19
 9 CS       enrollment     248    92
10 CS       6 months       202    84
11 CS       18 months      161    63
12 RC       enrollment     248    91
13 RC       6 months       202    82
14 RC       18 months      161    63
15 EC       enrollment     248    92
16 EC       6 months       201    82
17 EC       18 months      161    63
18 FM       enrollment     248    92
19 FM       6 months       202    83
20 FM       18 months      161    63
21 GM       enrollment     248    91
22 GM       6 months       201    84
23 GM       18 months      161    63</code></pre>
</div>
</div>
<p>Looking at the HFMD effects:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>), <span class="at">plt =</span> <span class="fu">c</span>(.<span class="dv">15</span>, .<span class="dv">97</span>, .<span class="dv">15</span>, .<span class="dv">9</span>))</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_effects_all</span>(output_sev)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_Bayley_sev-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ev71-cases" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="ev71-cases"><span class="header-section-number">11.2</span> EV71 cases</h3>
<p>Running the pipeline on the EV71 cases only:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>output_ev71 <span class="ot">&lt;-</span> <span class="fu">filter_patients</span>(group <span class="sc">==</span> <span class="st">"control"</span> <span class="sc">|</span> <span class="fu">str_detect</span>(PCR, <span class="st">"EV-A71"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pipeline</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The number of data points:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>output_ev71 <span class="sc">|&gt;</span> </span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(response, timepoint, control, HFMD) <span class="sc">|&gt;</span> </span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 23 × 4
   response timepoint  control  HFMD
   &lt;chr&gt;    &lt;chr&gt;        &lt;int&gt; &lt;int&gt;
 1 MD1ISS   18 months       69    16
 2 MD2ISS   18 months       69    15
 3 MD3ISS   18 months       69    16
 4 AC1ISS   18 months       69    15
 5 AC2ISS   18 months       69    15
 6 BAL1ISS  18 months       69    15
 7 BAL2ISS  18 months       69    15
 8 BAL3ISS  18 months       67    15
 9 CS       enrollment     248    41
10 CS       6 months       202    36
11 CS       18 months      161    20
12 RC       enrollment     248    41
13 RC       6 months       202    36
14 RC       18 months      161    20
15 EC       enrollment     248    41
16 EC       6 months       201    36
17 EC       18 months      161    20
18 FM       enrollment     248    41
19 FM       6 months       202    36
20 FM       18 months      161    20
21 GM       enrollment     248    40
22 GM       6 months       201    36
23 GM       18 months      161    20</code></pre>
</div>
</div>
<p>Looking at the HFMD effects:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>), <span class="at">plt =</span> <span class="fu">c</span>(.<span class="dv">15</span>, .<span class="dv">97</span>, .<span class="dv">15</span>, .<span class="dv">9</span>))</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_effects_all</span>(output_ev71)</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_Bayley_ev71-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="severe-ev71-cases" class="level3" data-number="11.3">
<h3 data-number="11.3" class="anchored" data-anchor-id="severe-ev71-cases"><span class="header-section-number">11.3</span> Severe EV71 cases</h3>
<p>Running the pipeline on the EV71 cases only:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>output_sev71 <span class="ot">&lt;-</span> <span class="fu">filter_patients</span>(group <span class="sc">==</span> <span class="st">"control"</span> <span class="sc">|</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>                                  (<span class="fu">str_detect</span>(PCR, <span class="st">"EV-A71"</span>) <span class="sc">&amp;</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="sc">!</span>(HFMD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"grade 2a"</span>, <span class="st">"Not Applicable"</span>)))) <span class="sc">|&gt;</span> </span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pipeline</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The number of data points:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>output_sev71 <span class="sc">|&gt;</span> </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(response, timepoint, control, HFMD) <span class="sc">|&gt;</span> </span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 23 × 4
   response timepoint  control  HFMD
   &lt;chr&gt;    &lt;chr&gt;        &lt;int&gt; &lt;int&gt;
 1 MD1ISS   18 months       69    12
 2 MD2ISS   18 months       69    11
 3 MD3ISS   18 months       69    12
 4 AC1ISS   18 months       69    11
 5 AC2ISS   18 months       69    11
 6 BAL1ISS  18 months       69    11
 7 BAL2ISS  18 months       69    11
 8 BAL3ISS  18 months       67    11
 9 CS       enrollment     248    29
10 CS       6 months       202    26
11 CS       18 months      161    14
12 RC       enrollment     248    29
13 RC       6 months       202    26
14 RC       18 months      161    14
15 EC       enrollment     248    29
16 EC       6 months       201    26
17 EC       18 months      161    14
18 FM       enrollment     248    29
19 FM       6 months       202    26
20 FM       18 months      161    14
21 GM       enrollment     248    29
22 GM       6 months       201    26
23 GM       18 months      161    14</code></pre>
</div>
</div>
<p>Looking at the HFMD effects:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>), <span class="at">plt =</span> <span class="fu">c</span>(.<span class="dv">15</span>, .<span class="dv">97</span>, .<span class="dv">15</span>, .<span class="dv">9</span>))</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_effects_all</span>(output_sev71)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_Bayley_sev71-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>