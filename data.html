<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>08RS data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="data_files/libs/clipboard/clipboard.min.js"></script>
<script src="data_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="data_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="data_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="data_files/libs/quarto-html/popper.min.js"></script>
<script src="data_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="data_files/libs/quarto-html/anchor.min.js"></script>
<link href="data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="data_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="data_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="data_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="data_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#global-parameters" id="toc-global-parameters" class="nav-link active" data-scroll-target="#global-parameters"><span class="header-section-number">1</span> Global parameters</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages"><span class="header-section-number">2</span> Packages</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions"><span class="header-section-number">3</span> Functions</a></li>
  <li><a href="#rs-crf-data" id="toc-rs-crf-data" class="nav-link" data-scroll-target="#rs-crf-data"><span class="header-section-number">4</span> 08RS CRF data</a></li>
  <li><a href="#ei-crf-data" id="toc-ei-crf-data" class="nav-link" data-scroll-target="#ei-crf-data"><span class="header-section-number">5</span> 02EI CRF data</a></li>
  <li><a href="#pcr-data" id="toc-pcr-data" class="nav-link" data-scroll-target="#pcr-data"><span class="header-section-number">6</span> PCR data</a></li>
  <li><a href="#mri-data" id="toc-mri-data" class="nav-link" data-scroll-target="#mri-data"><span class="header-section-number">7</span> MRI data</a></li>
  <li><a href="#children-data" id="toc-children-data" class="nav-link" data-scroll-target="#children-data"><span class="header-section-number">8</span> Children data</a>
  <ul>
  <li><a href="#rs-pcr-mri" id="toc-rs-pcr-mri" class="nav-link" data-scroll-target="#rs-pcr-mri"><span class="header-section-number">8.1</span> 08RS, PCR, MRI</a></li>
  <li><a href="#patching-02ei-crf" id="toc-patching-02ei-crf" class="nav-link" data-scroll-target="#patching-02ei-crf"><span class="header-section-number">8.2</span> Patching 02EI CRF</a></li>
  <li><a href="#stunt-and-waste" id="toc-stunt-and-waste" class="nav-link" data-scroll-target="#stunt-and-waste"><span class="header-section-number">8.3</span> Stunt and waste</a></li>
  <li><a href="#missing-values" id="toc-missing-values" class="nav-link" data-scroll-target="#missing-values"><span class="header-section-number">8.4</span> Missing values</a></li>
  </ul></li>
  <li><a href="#m-abc-data" id="toc-m-abc-data" class="nav-link" data-scroll-target="#m-abc-data"><span class="header-section-number">9</span> M-ABC data</a></li>
  <li><a href="#bayley-data" id="toc-bayley-data" class="nav-link" data-scroll-target="#bayley-data"><span class="header-section-number">10</span> Bayley data</a></li>
  <li><a href="#saras-csv-file" id="toc-saras-csv-file" class="nav-link" data-scroll-target="#saras-csv-file"><span class="header-section-number">11</span> Saras’ CSV file</a></li>
  <li><a href="#time-points" id="toc-time-points" class="nav-link" data-scroll-target="#time-points"><span class="header-section-number">12</span> Time points</a>
  <ul>
  <li><a href="#m-abc-data-1" id="toc-m-abc-data-1" class="nav-link" data-scroll-target="#m-abc-data-1"><span class="header-section-number">12.1</span> M-ABC data</a></li>
  <li><a href="#bayley-data-1" id="toc-bayley-data-1" class="nav-link" data-scroll-target="#bayley-data-1"><span class="header-section-number">12.2</span> Bayley data</a></li>
  <li><a href="#merging" id="toc-merging" class="nav-link" data-scroll-target="#merging"><span class="header-section-number">12.3</span> Merging</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization"><span class="header-section-number">12.4</span> Visualization</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis"><span class="header-section-number">13</span> Analysis</a>
  <ul>
  <li><a href="#hfmd-vs-controls" id="toc-hfmd-vs-controls" class="nav-link" data-scroll-target="#hfmd-vs-controls"><span class="header-section-number">13.1</span> HFMD vs controls</a></li>
  <li><a href="#propensity-scores" id="toc-propensity-scores" class="nav-link" data-scroll-target="#propensity-scores"><span class="header-section-number">13.2</span> Propensity scores</a></li>
  <li><a href="#tmle" id="toc-tmle" class="nav-link" data-scroll-target="#tmle"><span class="header-section-number">13.3</span> TMLE</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">08RS data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="global-parameters" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="global-parameters"><span class="header-section-number">1</span> Global parameters</h2>
<p>The path to the data folder on the local computer:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>root <span class="ot">&lt;-</span> <span class="st">"~/Library/CloudStorage/OneDrive-OxfordUniversityClinicalResearchUnit/"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data_folder <span class="ot">&lt;-</span> <span class="fu">paste0</span>(root, <span class="st">"GitHub/choisy/08RS/"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="packages" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="packages"><span class="header-section-number">2</span> Packages</h2>
<p>Required packages:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>required <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"readxl"</span>, <span class="st">"purrr"</span>, <span class="st">"dplyr"</span>, <span class="st">"magrittr"</span>, <span class="st">"tidyr"</span>, <span class="st">"anthro"</span>, <span class="st">"twang"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"cobalt"</span>, <span class="st">"survey"</span>, <span class="st">"tmle"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Installing those that are not installed yet:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>to_install <span class="ot">&lt;-</span> required[<span class="sc">!</span> required <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="st">"Package"</span>]]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(to_install)) <span class="fu">install.packages</span>(to_install)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Loading some packages for interactive use:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(twang)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmle)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="functions" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="functions"><span class="header-section-number">3</span> Functions</h2>
<p>A tuning of the <code>readxl::read_excel()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>read_excel2 <span class="ot">&lt;-</span> <span class="cf">function</span>(file, ...) readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="fu">paste0</span>(data_folder, file), ...)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that reads all the tabs of an excel file in the data folder <code>data_folder</code> defined above:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>read_excel_file <span class="ot">&lt;-</span> <span class="cf">function</span>(file) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  sheets_names <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">excel_sheets</span>(<span class="fu">paste0</span>(data_folder, file))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  sheets_names <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">read_excel2</span>(file, .x)) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(sheets_names)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that remove some slots of a list, by names:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>remove_slots <span class="ot">&lt;-</span> <span class="cf">function</span>(lst, slt) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  lst[<span class="fu">setdiff</span>(<span class="fu">names</span>(lst), slt)]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that extracts some variables of some slots of a list <code>x</code> of data frames:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>get_vars <span class="ot">&lt;-</span> <span class="cf">function</span>(sel, x) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">extract</span>(<span class="fu">names</span>(sel)) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map2</span>(sel, <span class="sc">~</span> <span class="fu">select</span>(.x, <span class="sc">!!!</span>.y))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The variables in questions are defined in the named list <code>sel</code> of character vectors. The names of this list should be among the names of <code>x</code> and the character vectors of each slots should be among the names of the columns of the data frames in the corresponding slots. A function that patches data values from the data frame <code>patch</code> into the data frame <code>df</code>, using the <code>key</code> variable as a common key between the two data frames:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>patch <span class="ot">&lt;-</span> <span class="cf">function</span>(patch, df, key) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  ref <span class="ot">&lt;-</span> df[, key]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> df[[key]] <span class="sc">%in%</span> patch[[key]]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> df[sel, ]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  tmp_names <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(patch, tmp[, <span class="fu">setdiff</span>(tmp_names, <span class="fu">names</span>(patch))])[tmp_names]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  df[<span class="sc">!</span> sel, ] <span class="sc">|&gt;</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(tmp) <span class="sc">|&gt;</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(<span class="at">x =</span> ref, <span class="at">y =</span> _, <span class="at">by =</span> key)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that renames a column of a data frame:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rename2 <span class="ot">&lt;-</span> <span class="cf">function</span>(df, newname, oldname) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  df_names <span class="ot">&lt;-</span> <span class="fu">names</span>(df)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  df_names[<span class="fu">which</span>(df_names <span class="sc">==</span> oldname)] <span class="ot">&lt;-</span> newname</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(df, df_names)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that splits a data frame into a list of data frames:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>split_df <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n_rows) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  nb_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(x, <span class="fu">gl</span>(nb_rows <span class="sc">%/%</span> n_rows <span class="sc">+</span> (nb_rows <span class="sc">%%</span> n_rows <span class="sc">&gt;</span> <span class="dv">0</span>), n_rows, nb_rows))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that appends a data frame <code>x</code> with <code>n</code> rows of values <code>v</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>append_dataframe <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">v =</span> <span class="dv">0</span>) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(x) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">rep</span>(v, n)) <span class="sc">|&gt;</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(<span class="fu">names</span>(x)) <span class="sc">|&gt;</span>  </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    (\(y) <span class="fu">bind_rows</span>(x, y))()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that applies <code>append_dataframe()</code> to the last slot of a list <code>x</code> of data frame so that the number of rows of the data frame in the last slot is equal to the number of rows of the data frame in the first lost:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>append_last <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">v =</span> <span class="dv">1</span>) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  nb_slots <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  nb_rows1 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x[[<span class="dv">1</span>]])</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  nb_rows2 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x[[nb_slots]])</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (nb_rows2 <span class="sc">&lt;</span> nb_rows1) {</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x[[nb_slots]] <span class="ot">&lt;-</span> <span class="fu">append_dataframe</span>(x[[nb_slots]], nb_rows1 <span class="sc">-</span> nb_rows2, v)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>image()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>image2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, z, ...) <span class="fu">image</span>(x, y, <span class="fu">t</span>(z[<span class="fu">nrow</span>(z)<span class="sc">:</span><span class="dv">1</span>, ]), ...)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that adds a zero y value to both ends of a data frame with two columns <code>x</code> and <code>y</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>adding_zero_ys <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(x[<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)])</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">head</span>(x, <span class="dv">1</span>), x, <span class="fu">tail</span>(x, <span class="dv">1</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>y[<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(x))] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that converts a 1-row matrix with columns names into a named vector:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>as_vector <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">setNames</span>(<span class="fu">as.vector</span>(x), <span class="fu">colnames</span>(x))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>coef()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>coef2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">last</span>(<span class="fu">coef</span>(x))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>confint()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>confint2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">as_vector</span>(<span class="fu">last</span>(<span class="fu">suppressMessages</span>(<span class="fu">confint</span>(x))))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that retrieve the p value of the last parameter of a model:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>get_p <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">last</span>(<span class="fu">as.vector</span>(<span class="fu">coefficients</span>(<span class="fu">summary</span>(x))))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of the <code>svyglm()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>svyglm2 <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data, w) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> w, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svyglm</span>(formula, <span class="at">design =</span> _)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="rs-crf-data" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="rs-crf-data"><span class="header-section-number">4</span> 08RS CRF data</h2>
<p>Loading the data from CliRes:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>CRF08RS <span class="ot">&lt;-</span> <span class="fu">read_excel_file</span>(<span class="st">"6-11-2024-CTU08RS_Data.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The names of the data frames in CliRes and in Saras’ code, with definitions:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CliRes        Saras           Definition</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ENROL         data_EN         enrollment</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># HIST          data_HIST       history at enrollment</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># CONHIST       CONHIST         contact history at enrollment</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># EXAM          data_EX         symptoms and signs at enrollment</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># LAB           data_LAB        lab results at admission</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># NEU           data_NEU        neurological exam</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># DAILY         data_Daily      daily review</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># MED           data_MED        medications</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># DEVSOCSED     data_DEV        development and socio-economic data</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># DISC          data_DISC       discharge summary</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># FUP           data_FUP        first follow-up day 7-10</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># FUP_II        data_FUP6m      first follow-up month 6</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># FUP_III       data_FUP18m     first follow-up month 18</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># NEURO         data_NEURO      neurological assessment</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ABC           data_MABC       movement ABC-2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The 08RS CRF dictionary:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>CRF_dict <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">devsocsed =</span> <span class="fu">list</span>(<span class="at">MomEdu =</span> <span class="fu">c</span>(<span class="st">"Never been to school"</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Attended some primary school"</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Completed primary school (5th gr)"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Completed lower secondary school (9th gr)"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Completed higher secondary school (12th gr)"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Completed university/college degree"</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Completed postgraduate degree"</span>),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Toilet =</span> <span class="fu">c</span>(<span class="st">"Own flush toilet"</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Shared flush toilet"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Traditional pit toilet"</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Ventilation improved pit toilet"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"No facility/bush/field"</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"None of above"</span>),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Water  =</span> <span class="fu">c</span>(<span class="st">"Private tap"</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Public standpipe"</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Bottled water"</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Well in own residence"</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Public well"</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Rain water"</span>,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Spring"</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"River/lake/pond"</span>, <span class="cn">NA</span>,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"None of the above"</span>)),</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">disc =</span> <span class="fu">list</span>(<span class="at">GradeHFMD   =</span> <span class="fu">c</span>(<span class="st">"grade 1"</span>,</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"grade 2a"</span>,</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"grade 2b(1)"</span>,</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"grade 2b(2)"</span>,</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"grade 3"</span>,</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"grade 4"</span>,</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Not Applicable"</span>),</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">Outcome     =</span> <span class="fu">c</span>(<span class="st">"Full recovery without complication"</span>,</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Incomplete recovery"</span>,</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Transferred to another hospital"</span>,</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Taken home without approval"</span>,</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Death"</span>,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Discharged to die"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Selection of variables from the 08RS CRF:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>selection08RS <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ENROL     =</span> <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"DateEnrol"</span>, <span class="st">"Gender"</span>, <span class="st">"DateBirth"</span>),</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">HIST      =</span> <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"DateIllness"</span>, <span class="st">"DateAdmHTD"</span>, <span class="st">"DateAdmHTD"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"DateAdmHosp"</span>, <span class="st">"HFMDToday"</span>, <span class="st">"HFMDAdmitted"</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">EXAM      =</span> <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"headCircumference"</span>, <span class="st">"height"</span>, <span class="st">"weigh"</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">DEVSOCSED =</span> <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"MomEdu"</span>, <span class="st">"Toilet"</span>, <span class="st">"Refrigerator"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"AirConditioner"</span>, <span class="st">"Motorbike"</span>, <span class="st">"Water"</span>),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">DISC      =</span> <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"DateDisc"</span>, <span class="st">"GradeHFMD"</span>, <span class="st">"TreatSepsis"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Outcome"</span>, <span class="st">"Seizure"</span>, <span class="st">"Hypertonicity"</span>, <span class="st">"LimbPara"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"CNP"</span>, <span class="st">"DiapWeak"</span>, <span class="st">"Trache"</span>, <span class="st">"Nasotube"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"BehaveChange"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="ei-crf-data" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="ei-crf-data"><span class="header-section-number">5</span> 02EI CRF data</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>CRF02EI <span class="ot">&lt;-</span> <span class="fu">read_excel_file</span>(<span class="st">"6-11-2024-CTU02EI_Data.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Selection of variables from the 02EI CRF:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>selection02EI <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Demo  =</span> <span class="fu">c</span>(<span class="st">"studyCode"</span>, <span class="st">"height"</span>, <span class="st">"weight"</span>),</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Hist  =</span> <span class="fu">c</span>(<span class="st">"studyCode"</span>, <span class="st">"IllnessDate"</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Disch =</span> <span class="fu">c</span>(<span class="st">"studyCode"</span>, <span class="st">"seizures"</span>, <span class="st">"tracheostomy"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"muscleStength"</span>, <span class="st">"limbParalysing"</span>, <span class="st">"nerveParalysing"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="pcr-data" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="pcr-data"><span class="header-section-number">6</span> PCR data</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>PCR <span class="ot">&lt;-</span> <span class="st">"03EI-08RS PCR-Seq result.xlsx"</span> <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel2</span>(<span class="st">"08RS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, <span class="st">`</span><span class="at">OUCRU RESULT</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(ID, as.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.exclude</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="mri-data" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="mri-data"><span class="header-section-number">7</span> MRI data</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>MRI <span class="ot">&lt;-</span> <span class="fu">paste0</span>(root, <span class="st">"GitHub/choisy/08RS/part_dataMRIentry_28AUG15_errorcor.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID =</span> code) <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Final, Acute) <span class="sc">|&gt;</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">"Final"</span>, <span class="st">"Acute"</span>), <span class="sc">~</span> .x <span class="sc">==</span> <span class="st">"Yes"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>What is the difference between <code>Final</code> and <code>Acute</code>?</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(MRI, Final <span class="sc">!=</span> Acute)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
      ID Final Acute
   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;
 1    47 TRUE  FALSE
 2    51 TRUE  FALSE
 3   550 TRUE  FALSE
 4   551 TRUE  FALSE
 5   557 TRUE  FALSE
 6   575 TRUE  FALSE
 7   596 TRUE  FALSE
 8   597 TRUE  FALSE
 9   599 TRUE  FALSE
10   622 TRUE  FALSE</code></pre>
</div>
</div>
</section>
<section id="children-data" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="children-data"><span class="header-section-number">8</span> Children data</h2>
<section id="rs-pcr-mri" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="rs-pcr-mri"><span class="header-section-number">8.1</span> 08RS, PCR, MRI</h3>
<p>The case and control groups:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"HFMD"</span>, <span class="dv">299</span>), <span class="fu">rep</span>(<span class="st">"control"</span>, <span class="dv">200</span>),</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="st">"HFMD"</span>, <span class="dv">200</span>), <span class="fu">rep</span>(<span class="st">"control"</span>, <span class="dv">299</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>First recoding of variables:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>recoding1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(Gender, <span class="sc">~</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)[.x]),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Date"</span>), as.Date),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(<span class="fu">c</span>(<span class="st">"Refrigerator"</span>, <span class="st">"AirConditioner"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Motorbike"</span>, <span class="st">"TreatSepsis"</span>), <span class="sc">~</span> .x <span class="sc">&lt;</span> <span class="dv">2</span>))</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Second recoding of variables:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>recoding2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(HFMD, <span class="sc">~</span> CRF_dict<span class="sc">$</span>disc<span class="sc">$</span>GradeHFMD[.x]),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(MomEdu, <span class="sc">~</span> CRF_dict<span class="sc">$</span>devsocsed<span class="sc">$</span>MomEdu[.x]),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(Toilet, <span class="sc">~</span> CRF_dict<span class="sc">$</span>devsocsed<span class="sc">$</span>Toilet[.x]),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(Water, <span class="sc">~</span> CRF_dict<span class="sc">$</span>devsocsed<span class="sc">$</span>Water[.x]),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(Outcome, <span class="sc">~</span> CRF_dict<span class="sc">$</span>disc<span class="sc">$</span>Outcome[.x]))</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Selecting and recoding the variables from the 08RS CRF, and assigning to case or control:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>children <span class="ot">&lt;-</span> selection08RS <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_slots</span>(<span class="st">"ABC"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_vars</span>(CRF08RS) <span class="sc">|&gt;</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(left_join, <span class="at">by =</span> <span class="st">"ParNo"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">HFMD =</span> <span class="fu">max</span>(<span class="fu">across</span>(<span class="fu">c</span>(HFMDToday, HFMDAdmitted, GradeHFMD)))) <span class="sc">|&gt;</span> <span class="co">#takes max grade</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recoding1</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recoding2</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID    =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(ParNo, <span class="st">"^.*-"</span>)),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> groups[ID]) <span class="sc">|&gt;</span> </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(MRI, <span class="st">"ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(PCR, <span class="st">"ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">PCR =</span> <span class="st">`</span><span class="at">OUCRU RESULT</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>HFMDToday, <span class="sc">-</span>HFMDAdmitted, <span class="sc">-</span>GradeHFMD, <span class="sc">-</span>ID) <span class="sc">|&gt;</span> </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ParNo, Gender, DateBirth, DateIllness, DateAdmHosp,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>         DateAdmHTD, DateEnrol, DateDisc, <span class="fu">everything</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ParNo)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="patching-02ei-crf" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="patching-02ei-crf"><span class="header-section-number">8.2</span> Patching 02EI CRF</h3>
<p>Conversion of IDs between 02EI and 08RS:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>(ID_conv <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">s02EI =</span> <span class="fu">paste0</span>(<span class="st">"03-0"</span>, <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"0"</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">9</span>)), <span class="fu">c</span>(<span class="st">"11"</span>, <span class="st">"13"</span>))),</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">s08RS =</span> <span class="fu">paste0</span>(<span class="st">"03-0"</span>, <span class="fu">c</span>(<span class="dv">43</span>, <span class="dv">52</span><span class="sc">:</span><span class="dv">56</span>, <span class="dv">60</span>, <span class="dv">62</span>, <span class="dv">78</span>, <span class="dv">79</span>))))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   s02EI  s08RS 
   &lt;chr&gt;  &lt;chr&gt; 
 1 03-001 03-043
 2 03-003 03-052
 3 03-004 03-053
 4 03-005 03-054
 5 03-006 03-055
 6 03-007 03-056
 7 03-008 03-060
 8 03-009 03-062
 9 03-011 03-078
10 03-013 03-079</code></pre>
</div>
</div>
<p>Patching the data values from the 02EI CRF:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>children <span class="ot">&lt;-</span> selection02EI <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_vars</span>(CRF02EI) <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(left_join, <span class="at">by =</span> <span class="st">"studyCode"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(IllnessDate, as.Date),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(<span class="st">"seizures"</span>, <span class="st">"tracheostomy"</span>, <span class="st">"muscleStength"</span>, <span class="st">"limbParalysing"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nerveParalysing"</span>), <span class="sc">~</span> .x <span class="sc">&lt;</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ParNo         =</span> studyCode,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">weigh         =</span> weight,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">DateIllness   =</span> IllnessDate,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Seizure       =</span> seizures,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">Trache        =</span> tracheostomy,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Hypertonicity =</span> muscleStength,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">LimbPara      =</span> limbParalysing,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">CNP           =</span> nerveParalysing) <span class="sc">|&gt;</span> </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ParNo <span class="sc">%in%</span> ID_conv<span class="sc">$</span>s02EI) <span class="sc">|&gt;</span> </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(ParNo, <span class="sc">~</span> <span class="fu">unname</span>(<span class="fu">with</span>(ID_conv, <span class="fu">setNames</span>(s08RS, s02EI))[.x]))) <span class="sc">|&gt;</span> </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">patch</span>(children, <span class="st">"ParNo"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="stunt-and-waste" class="level3" data-number="8.3">
<h3 data-number="8.3" class="anchored" data-anchor-id="stunt-and-waste"><span class="header-section-number">8.3</span> Stunt and waste</h3>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>children <span class="ot">&lt;-</span> children <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> DateEnrol <span class="sc">-</span> DateBirth,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">z   =</span> anthro<span class="sc">::</span><span class="fu">anthro_zscores</span>(<span class="fu">c</span>(<span class="at">male =</span> <span class="dv">1</span>, <span class="at">female =</span> <span class="dv">2</span>)[Gender],</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">as.numeric</span>(age),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">weight =</span> weigh,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">lenhei =</span> height)[<span class="fu">c</span>(<span class="st">"zlen"</span>, <span class="st">"zwfl"</span>)]) <span class="sc">|&gt;</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(z) <span class="sc">|&gt;</span> </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stunting =</span> zlen <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">wasting  =</span> <span class="fu">ifelse</span>(zwfl <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">3</span>, <span class="st">"severe"</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(zwfl <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">2</span>, <span class="st">"moderate"</span>, <span class="st">"no"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span> zlen, <span class="sc">-</span> zwfl)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="missing-values" class="level3" data-number="8.4">
<h3 data-number="8.4" class="anchored" data-anchor-id="missing-values"><span class="header-section-number">8.4</span> Missing values</h3>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(children)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>children <span class="sc">|&gt;</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span> group) <span class="sc">|&gt;</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.x))) <span class="sc">|&gt;</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span> ParNo, <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"number_of_NA"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage_of_NA =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> number_of_NA <span class="sc">/</span> n)) <span class="sc">|&gt;</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span> ParNo) <span class="sc">|&gt;</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 3
   variable          number_of_NA percentage_of_NA
   &lt;chr&gt;                    &lt;int&gt;            &lt;dbl&gt;
 1 Gender                       0                0
 2 DateBirth                    0                0
 3 DateIllness                294               55
 4 DateAdmHosp                533               99
 5 DateAdmHTD                 299               56
 6 DateEnrol                    0                0
 7 DateDisc                   303               56
 8 headCircumference          137               26
 9 height                     117               22
10 weigh                      115               21
11 MomEdu                       1                0
12 Toilet                       1                0
13 Refrigerator                 0                0
14 AirConditioner               0                0
15 Motorbike                    0                0
16 Water                        0                0
17 TreatSepsis                313               58
18 Outcome                    303               56
19 Seizure                    294               55
20 Hypertonicity              294               55
21 LimbPara                   294               55
22 CNP                        294               55
23 DiapWeak                   303               56
24 Trache                     294               55
25 Nasotube                   303               56
26 BehaveChange               303               56
27 HFMD                       310               58
28 Final                      449               84
29 Acute                      449               84
30 PCR                        295               55
31 age                          0                0
32 stunting                   117               22
33 wasting                    118               22</code></pre>
</div>
</div>
</section>
</section>
<section id="m-abc-data" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="m-abc-data"><span class="header-section-number">9</span> M-ABC data</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ABC <span class="ot">&lt;-</span> CRF08RS<span class="sc">$</span>ABC <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ParNo, DateTested, <span class="fu">ends_with</span>(<span class="st">"ISS"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Date"</span>), as.Date)) <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ParNo, DateTested)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Of note, here</p>
<ul>
<li><code>MD</code> stands for manual dexterity,</li>
<li><code>AC</code> stands for aiming and catching and</li>
<li><code>BAL</code> stands for balance.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>ABC <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.exclude</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 221 × 10
   ParNo  DateTested MD1ISS MD2ISS MD3ISS AC1ISS AC2ISS BAL1ISS BAL2ISS BAL3ISS
   &lt;chr&gt;  &lt;date&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 03-001 2013-06-21      4      8      0      0      0       0       0       0
 2 03-001 2014-12-17      3     10      6     11      6       6       7       1
 3 03-001 2015-06-30      5     12      1      9     10       3       1       1
 4 03-003 2015-01-15     11     14     13     12     14      14      13      12
 5 03-004 2015-01-20     14     16      1      9      6       7       7       6
 6 03-007 2015-02-02      9     10      5      8     12      10      11       6
 7 03-010 2014-03-20      6     11      1      7     11       6      13       6
 8 03-010 2015-03-20     12     12      6     11     12       8      13       4
 9 03-016 2015-04-07      8     14     12     12     12       9      13       5
10 03-020 2014-06-24     11     13     10     12     11       9      13      12
# ℹ 211 more rows</code></pre>
</div>
</div>
</section>
<section id="bayley-data" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="bayley-data"><span class="header-section-number">10</span> Bayley data</h2>
<p>Loading the data from CliRes:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>Bayley0 <span class="ot">&lt;-</span> <span class="fu">read_excel_file</span>(<span class="st">"12-9-2025-Bayley_v3_P1_Data.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The tabs that we are interested in are the following:</p>
<ul>
<li><strong>CS:</strong> cognitive scale</li>
<li><strong>RC:</strong> receptive communication (language scale)</li>
<li><strong>EC:</strong> expressive communication (language scale)</li>
<li><strong>FM:</strong> fine motor (motor scale)</li>
<li><strong>GM:</strong> gross motor (motor scale)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>Bayley_tabs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CS"</span>, <span class="st">"RC"</span>, <span class="st">"EC"</span>, <span class="st">"FM"</span>, <span class="st">"GM"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s generate the data frame from these tabs:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>common_variables1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PARNO"</span>, <span class="st">"DATETESTED"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>common_variables2 <span class="ot">&lt;-</span> <span class="fu">c</span>(common_variables1, <span class="st">"SCALESCORE"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>Bayley<span class="ot">&lt;-</span> Bayley_tabs <span class="sc">|&gt;</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">c</span>(common_variables2, .x)) <span class="sc">|&gt;</span> </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(Bayley_tabs) <span class="sc">|&gt;</span> </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_vars</span>(Bayley0) <span class="sc">|&gt;</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2</span>(<span class="fu">paste0</span>(<span class="st">"SCALESCORE_"</span>, Bayley_tabs), rename2, <span class="st">"SCALESCORE"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(left_join, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"PARNO"</span>, <span class="st">"DATETESTED"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"DATE"</span>), as.Date)) <span class="sc">|&gt;</span> </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ParNo =</span> PARNO) <span class="sc">|&gt;</span> </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(ParNo, <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(.x, <span class="st">"08RS_"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="saras-csv-file" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="saras-csv-file"><span class="header-section-number">11</span> Saras’ CSV file</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>saras <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(root, <span class="st">"GitHub/choisy/08RS/complete data including all withdrawals_updated26_3_21.csv"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(saras, waste, visitM, ddifENB, ddifEN, FUP, FUP1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,408 × 6
   waste      visitM ddifENB ddifEN FUP   FUP1 
   &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
 1 Not Wasted      2      NA    547 18m   18m  
 2 Not Wasted     NA     184     NA 6m    &lt;NA&gt; 
 3 Not Wasted      1      NA      3 ENROL ENROL
 4 Not Wasted      2      NA    547 18m   18m  
 5 Not Wasted      1     182    182 6m    6m   
 6 Not Wasted     NA      11     NA ENROL &lt;NA&gt; 
 7 Not Wasted     NA     567     NA 18m   &lt;NA&gt; 
 8 Not Wasted     NA     204     NA 6m    &lt;NA&gt; 
 9 Not Wasted     NA      14     NA ENROL &lt;NA&gt; 
10 Not Wasted     NA      16     NA prem  &lt;NA&gt; 
# ℹ 1,398 more rows</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(saras<span class="sc">$</span>waste)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Not Wasted      Waste 
      1350         43 </code></pre>
</div>
</div>
</section>
<section id="time-points" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="time-points"><span class="header-section-number">12</span> Time points</h2>
<p>A function that generates the time points:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>make_time_points <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  children <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(ParNo, DateEnrol, DateDisc) <span class="sc">|&gt;</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(x, <span class="st">"ParNo"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time_diff =</span> DateTested <span class="sc">-</span> DateEnrol,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">time1 =</span> <span class="dv">0</span>, <span class="at">time2 =</span> <span class="dv">6</span>, <span class="at">time3 =</span> <span class="dv">18</span>, <span class="co"># in months</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(<span class="fu">c</span>(time1, time2, time3), <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">abs</span>(time_diff <span class="sc">-</span> <span class="dv">30</span> <span class="sc">*</span> .x)))) <span class="sc">|&gt;</span> </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">min_delay =</span> <span class="fu">min</span>(<span class="fu">across</span>(<span class="fu">c</span>(time1, time2, time3)))) <span class="sc">|&gt;</span> </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time_point =</span> <span class="fu">ifelse</span>(min_delay <span class="sc">==</span> time1,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"enrollment"</span>, <span class="fu">ifelse</span>(min_delay <span class="sc">==</span> time2,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"6 months"</span>, <span class="st">"18 months"</span>)))</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that gets the IDs of children with duplicated assessments:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>get_IDs_with_duplicated <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">is.na</span>(time_point)) <span class="sc">|&gt;</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(ParNo) <span class="sc">|&gt;</span> </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_modify</span>(<span class="sc">~</span> .x <span class="sc">|&gt;</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">group_by</span>(time_point) <span class="sc">|&gt;</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">tally</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(ParNo) <span class="sc">|&gt;</span> </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>()</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that uses the previous two to generate the data with duplicated assessments:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>show_duplicated_assessments <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  data_with_time_points <span class="ot">&lt;-</span> <span class="fu">make_time_points</span>(x)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  IDs_with_duplicates <span class="ot">&lt;-</span> <span class="fu">get_IDs_with_duplicated</span>(data_with_time_points)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_with_time_points, ParNo <span class="sc">%in%</span> IDs_with_duplicates)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="m-abc-data-1" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="m-abc-data-1"><span class="header-section-number">12.1</span> M-ABC data</h3>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>ABC <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_duplicated_assessments</span>() <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="st">"M-ABC2.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Here all the duplicates are complete. We’ll simply keep all the earlier ones:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>ABC2 <span class="ot">&lt;-</span> ABC <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_time_points</span>() <span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ParNo, time_point, min_delay) <span class="sc">|&gt;</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ParNo, time_point) <span class="sc">|&gt;</span> </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> <span class="fu">head</span>(.x, <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>DateEnrol, <span class="sc">-</span>DateDisc, <span class="sc">-</span>min_delay, <span class="sc">-</span> time_diff, <span class="sc">-</span>time1, <span class="sc">-</span>time2, <span class="sc">-</span>time3) <span class="sc">|&gt;</span> </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Date_ABC =</span> DateTested)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="bayley-data-1" class="level3" data-number="12.2">
<h3 data-number="12.2" class="anchored" data-anchor-id="bayley-data-1"><span class="header-section-number">12.2</span> Bayley data</h3>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>Bayley <span class="ot">&lt;-</span> <span class="fu">rename</span>(Bayley, <span class="at">DateTested =</span> DATETESTED)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>Bayley <span class="sc">|&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_duplicated_assessments</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="st">"Bayley2.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This shows that</p>
<ul>
<li>there is one and only one complete measurement per time point</li>
<li>the complete measurement is always the earlier one, except for patient <code>03-514</code></li>
</ul>
<p>In consequence, we decide to simply filter out all the incomplete duplicates:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>Bayley2 <span class="ot">&lt;-</span> Bayley <span class="sc">|&gt;</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_time_points</span>() <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ParNo, time_point) <span class="sc">|&gt;</span> </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> {<span class="cf">if</span> (<span class="fu">nrow</span>(.x) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="fu">return</span>(<span class="fu">na.exclude</span>(.x)); .x }) <span class="sc">|&gt;</span> </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>DateEnrol, <span class="sc">-</span>DateDisc, <span class="sc">-</span>min_delay, <span class="sc">-</span> time_diff, <span class="sc">-</span>time1, <span class="sc">-</span>time2, <span class="sc">-</span>time3) <span class="sc">|&gt;</span> </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Date_Bayley =</span> DateTested)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="merging" class="level3" data-number="12.3">
<h3 data-number="12.3" class="anchored" data-anchor-id="merging"><span class="header-section-number">12.3</span> Merging</h3>
<p>Merging the M-ABC and Bayley data:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>followups <span class="ot">&lt;-</span> <span class="fu">full_join</span>(ABC2, Bayley2, <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"time_point"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="visualization" class="level3" data-number="12.4">
<h3 data-number="12.4" class="anchored" data-anchor-id="visualization"><span class="header-section-number">12.4</span> Visualization</h3>
<p>A function that prepend all the data frames of a list <code>x</code> of data frames with <code>n</code> columns of the <code>v</code> values:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>prepend_white <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n, v) {</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  nbrows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x[[<span class="dv">1</span>]])</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  white_space <span class="ot">&lt;-</span> v <span class="sc">|&gt;</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(n <span class="sc">*</span> nbrows) <span class="sc">|&gt;</span> </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span>(nbrows) <span class="sc">|&gt;</span> </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(x, <span class="sc">~</span> <span class="fu">cbind</span>(white_space, .x))</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that (i) splits the data frame <code>x</code> into a list of data frame of <code>n</code> rows (except possibly for the last slot), (ii) prepends each of these data frames with <code>wc</code> columns of 1s, and (iii) concatenate all these data frames side by side into a matrix:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>side_by_side <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n, wc) {</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>ParNo) <span class="sc">|&gt;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split_df</span>(n) <span class="sc">|&gt;</span> </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">append_last</span>() <span class="sc">|&gt;</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prepend_white</span>(wc, <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">reduce</span>(cbind) <span class="sc">|&gt;</span> </span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>()</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A tuning of <code>image2()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>image3 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, col_no, col_yes) {</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">image2</span>(<span class="dv">0</span><span class="sc">:</span><span class="fu">ncol</span>(x), <span class="dv">0</span><span class="sc">:</span><span class="fu">nrow</span>(x), x, <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">ann =</span> <span class="cn">FALSE</span>, <span class="at">col =</span> <span class="fu">c</span>(col_no, col_yes))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The function that plots the heatmap:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>heatmap2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">nbrow =</span> <span class="dv">45</span>, <span class="at">nb_wc =</span> <span class="dv">2</span>,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_Bayley =</span> <span class="fu">adjustcolor</span>(<span class="st">"red"</span>, .<span class="dv">3</span>),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_ABC    =</span> <span class="fu">adjustcolor</span>(<span class="st">"blue"</span>, .<span class="dv">3</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_NA     =</span> <span class="fu">adjustcolor</span>(<span class="st">"white"</span>, <span class="dv">0</span>),</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_lines  =</span> <span class="st">"white"</span>) {</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting M-ABC data:</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Date_Bayley) <span class="sc">|&gt;</span> </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time_point, <span class="at">values_from =</span> Date_ABC) <span class="sc">|&gt;</span> </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">side_by_side</span>(nbrow, nb_wc)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">image3</span>(tmp, col_NA, col_Bayley)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co"># adding Bayley data:</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">new =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Date_ABC) <span class="sc">|&gt;</span> </span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time_point, <span class="at">values_from =</span> Date_Bayley) <span class="sc">|&gt;</span> </span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">side_by_side</span>(nbrow, nb_wc) <span class="sc">|&gt;</span> </span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">image3</span>(col_NA, col_ABC)</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="co"># adding separation lines:</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">ncol</span>(tmp), <span class="at">col =</span> col_lines)</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span><span class="sc">:</span>nbrow, <span class="at">col =</span> col_lines)</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a><span class="co"># adding children IDs:</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>  ids <span class="ot">&lt;-</span> <span class="fu">str_remove</span>(<span class="fu">unique</span>(x<span class="sc">$</span>ParNo), <span class="st">"^.*-"</span>)</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ids)</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> nb_wc</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>  ncol_tmp <span class="ot">&lt;-</span> <span class="fu">ncol</span>(tmp)</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>  nbcol <span class="ot">&lt;-</span> ncol_tmp <span class="sc">/</span> by</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1</span>, ncol_tmp, by), <span class="at">each =</span> nbrow)[sel]</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>  ys <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rev</span>(<span class="dv">1</span><span class="sc">:</span>nbrow <span class="sc">-</span> .<span class="dv">5</span>), nbcol)[sel]</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(xs, ys, ids)</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a><span class="co"># adding time points:</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>  xx <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span> <span class="sc">+</span> nb_wc, ncol_tmp, by) <span class="sc">-</span> .<span class="dv">5</span></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"e"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>), nbcol)[sel], <span class="at">at =</span> <span class="fu">sort</span>(<span class="fu">c</span>(xx, xx <span class="sc">+</span> <span class="dv">1</span>, xx <span class="sc">+</span> <span class="dv">2</span>)))</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>An overview of the M-ABC and Bayley data for all the children and the 3 time points:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expand_grid</span>(<span class="at">ParNo      =</span> <span class="fu">unique</span>(followups<span class="sc">$</span>ParNo),</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">time_point =</span> <span class="fu">c</span>(<span class="st">"enrollment"</span>, <span class="st">"6 months"</span>, <span class="st">"18 months"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(followups, <span class="fu">c</span>(<span class="st">"ParNo"</span>, <span class="st">"time_point"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ParNo, time_point, <span class="fu">starts_with</span>(<span class="st">"Date"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Date"</span>), <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="sc">!</span> <span class="fu">is.na</span>(.x)) <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">heatmap2</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_followup_data_availability-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>where blue is where the Bayley data are available, red is where the M-ABC data are available, purple is where both data are available and white is where none of the data are available.</p>
</section>
</section>
<section id="analysis" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="analysis"><span class="header-section-number">13</span> Analysis</h2>
<section id="hfmd-vs-controls" class="level3" data-number="13.1">
<h3 data-number="13.1" class="anchored" data-anchor-id="hfmd-vs-controls"><span class="header-section-number">13.1</span> HFMD vs controls</h3>
<p>From here we work with 2 data frames: <code>children</code> that contains the children information, and <code>followups</code> that contains the follow-up data. Note that height and weight (and consequently stunting) is missing for about 22% of children:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>children <span class="sc">|&gt;</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, age, MomEdu, Gender, stunting) <span class="sc">|&gt;</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_int</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.x)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   group      age   MomEdu   Gender stunting 
       0        0        1        0      117 </code></pre>
</div>
</div>
<p>Some common code:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>adjcol <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">adjustcolor</span>(..., <span class="at">alpha =</span> .<span class="dv">3</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>barplot2 <span class="ot">&lt;-</span> <span class="cf">function</span>(height, x) {</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">barplot</span>(height, <span class="at">names.arg =</span> x, <span class="at">beside =</span> <span class="cn">TRUE</span>, <span class="at">ylab =</span> <span class="st">"proportion"</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="fu">adjcol</span>(<span class="fu">rev</span>(cols)))</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>add_legend <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">where =</span> <span class="st">"topright"</span>) {</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(where, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"HFMD"</span>), <span class="at">fill =</span> <span class="fu">adjcol</span>(<span class="fu">rev</span>(cols)), <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s look at the age distribution of the controls and HFMD cases:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> children <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(age, <span class="sc">~</span> <span class="fu">as.numeric</span>(.x) <span class="sc">/</span> <span class="dv">30</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">|&gt;</span> </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_map</span>(<span class="sc">~</span> .x <span class="sc">|&gt;</span> <span class="fu">pull</span>(age) <span class="sc">|&gt;</span> <span class="fu">density</span>(<span class="at">from =</span> <span class="dv">0</span>))</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>tmp <span class="sc">|&gt;</span> </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> .x <span class="sc">|&gt;</span> <span class="fu">unclass</span>() <span class="sc">|&gt;</span> magrittr<span class="sc">::</span><span class="fu">extract</span>(<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(range) <span class="sc">|&gt;</span> </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">plot</span>(<span class="cn">NA</span>, <span class="at">xlim =</span> x, <span class="at">ylim =</span> y, <span class="at">xlab =</span> <span class="st">"age (months)"</span>, <span class="at">ylab =</span> <span class="st">"density"</span>))</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>tmp <span class="sc">|&gt;</span> </span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk2</span>(cols, <span class="sc">~</span> <span class="fu">polygon</span>(<span class="fu">adding_zero_ys</span>(.x), <span class="at">col =</span> <span class="fu">adjcol</span>(.y), <span class="at">border =</span> <span class="cn">NA</span>))</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="fu">add_legend</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_age_distribution-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s now look at the level of the mother’s education:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>edu_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Never been to school"</span>, <span class="st">"Attended some primary school"</span>,</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Completed primary school (5th gr)"</span>,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Completed lower secondary school (9th gr)"</span>,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Completed higher secondary school (12th gr)"</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Completed university/college degree"</span>, <span class="st">"Completed postgraduate degree"</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>children <span class="sc">|&gt;</span> </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(MomEdu, group)) <span class="sc">|&gt;</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">[</span><span class="st">`</span>(edu_order, ) <span class="sc">|&gt;</span> </span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">|&gt;</span> </span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">barplot2</span>(<span class="fu">c</span>(<span class="st">"none"</span>, <span class="st">"some"</span>, <span class="st">"5th grd"</span>, <span class="st">"9th grd"</span>, <span class="st">"12th grd"</span>, <span class="st">"college"</span>, <span class="st">"postgrad"</span>))</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="fu">add_legend</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_mom_edu-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Stunt and gender:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>children <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, Gender, stunting) <span class="sc">|&gt;</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.exclude</span>() <span class="sc">|&gt;</span> </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">|&gt;</span> </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>() <span class="sc">|&gt;</span> </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> .x <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Gender, stunting) <span class="sc">|&gt;</span> <span class="fu">tally</span>() <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(left_join, <span class="fu">c</span>(<span class="st">"Gender"</span>, <span class="st">"stunting"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"n"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span> </span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">[</span><span class="st">`</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, ) <span class="sc">|&gt;</span> </span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">barplot2</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>), <span class="at">each =</span> <span class="dv">2</span>))</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"non-stunt"</span>, <span class="st">"stunt"</span>), <span class="dv">2</span>), <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="at">at =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>))</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="fu">add_legend</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_files/figure-html/fig_sex_stunt-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="propensity-scores" class="level3" data-number="13.2">
<h3 data-number="13.2" class="anchored" data-anchor-id="propensity-scores"><span class="header-section-number">13.2</span> Propensity scores</h3>
<p>The covariates:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>covariables <span class="ot">&lt;-</span> <span class="fu">select</span>(children, ParNo, Gender, age, MomEdu, stunting, group)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The formula:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>ps_formula <span class="ot">&lt;-</span> group <span class="sc">~</span> Gender <span class="sc">+</span> age <span class="sc">+</span> MomEdu <span class="sc">+</span> stunting</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that generates a data set for a given response variable at a given time point:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>make_data <span class="ot">&lt;-</span> <span class="cf">function</span>(response, timepoint) {</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  followups <span class="sc">|&gt;</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(time_point <span class="sc">==</span> timepoint) <span class="sc">|&gt;</span> </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(ParNo, <span class="fu">all_of</span>(response)) <span class="sc">|&gt;</span> </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.exclude</span>() <span class="sc">|&gt;</span> </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(covariables, <span class="st">"ParNo"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>ParNo) <span class="sc">|&gt;</span> </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(response), group, <span class="fu">everything</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.exclude</span>()</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that generates weights from a logistic regression:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>logistic_ps <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(group, <span class="sc">~</span> .x <span class="sc">==</span> <span class="st">"HFMD"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glm</span>(ps_formula, binomial, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(<span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that generates weights from the <code>twang</code> package:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>twang_ps <span class="ot">&lt;-</span> <span class="cf">function</span>(data, ...) {</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(group, <span class="sc">~</span> <span class="fu">as.integer</span>(group <span class="sc">==</span> <span class="st">"HFMD"</span>)),</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.character</span>(.x) <span class="sc">|</span> <span class="fu">is.logical</span>(.x)), as.factor),</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(age, as.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ps</span>(ps_formula, <span class="at">data =</span> _, <span class="at">estimand =</span> <span class="st">"ATT"</span>, <span class="at">stop.method =</span> <span class="st">"es.mean"</span>,</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">verbose =</span> <span class="cn">FALSE</span>, ...) <span class="sc">|&gt;</span> </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get.weights</span>(<span class="st">"es.mean"</span>)  </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that computes balance statistics for diagnostic of the propensity scores:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>bal_tab <span class="ot">&lt;-</span> <span class="cf">function</span>(data, w) {</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(group, <span class="sc">~</span> .x <span class="sc">==</span> <span class="st">"HFMD"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bal.tab</span>(ps_formula, <span class="at">data =</span> _, <span class="at">weights =</span> w, <span class="at">s.d.denom =</span> <span class="st">"treated"</span>, <span class="at">un =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that retrieve the balance adjustments for diagnostic of the propensity scores:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>get_diff <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">$</span>Balance<span class="sc">$</span>Diff.Adj</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that produce the maximum values of the balance adjustments for diagnostic of the propensity scores:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>get_max_diff <span class="ot">&lt;-</span> <span class="cf">function</span>(data, w) {</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bal_tab</span>(w) <span class="sc">|&gt;</span> </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_diff</span>() <span class="sc">|&gt;</span> </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>()</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A function that generate the formula of the model with the response <code>y</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>reformulate2 <span class="ot">&lt;-</span> <span class="cf">function</span>(y) {</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reformulate</span>(<span class="fu">c</span>(<span class="st">"Gender"</span>, <span class="st">"age"</span>, <span class="st">"MomEdu"</span>, <span class="st">"stunting"</span>, <span class="st">"group"</span>), y)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The pipeline (takes 52”):</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>lr_ps <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">response  =</span> <span class="fu">c</span>(<span class="st">"MD1ISS"</span>, <span class="st">"MD2ISS"</span>, <span class="st">"MD3ISS"</span>, <span class="st">"AC1ISS"</span>, <span class="st">"AC2ISS"</span>,</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"BAL1ISS"</span>, <span class="st">"BAL2ISS"</span>, <span class="st">"BAL3ISS"</span>,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"CS"</span>, <span class="st">"RC"</span>, <span class="st">"EC"</span>, <span class="st">"FM"</span>, <span class="st">"GM"</span>),</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">timepoint =</span> <span class="fu">c</span>(<span class="st">"enrollment"</span>, <span class="st">"6 months"</span>, <span class="st">"18 months"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dataset =</span> <span class="fu">map2</span>(response, timepoint, <span class="sc">~</span> <span class="fu">make_data</span>(.x, .y)),</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ctable  =</span> <span class="fu">map</span>(dataset, <span class="sc">~</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(.x<span class="sc">$</span>group)))) <span class="sc">|&gt;</span> </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">map_lgl</span>(ctable, <span class="sc">~</span> <span class="fu">length</span>(.x) <span class="sc">&gt;</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ctable =</span> <span class="fu">map</span>(ctable, <span class="sc">~</span> <span class="fu">setNames</span>(.x, <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"HFMD"</span>)))) <span class="sc">|&gt;</span> </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(ctable) <span class="sc">|&gt;</span> </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HFMD <span class="sc">&gt;</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dataset =</span> <span class="fu">map</span>(dataset,</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">~</span> <span class="fu">mutate</span>(.x, <span class="at">ps =</span> <span class="fu">logistic_ps</span>(<span class="fu">pick</span>(<span class="fu">everything</span>())),</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">ow =</span> <span class="fu">ifelse</span>(group <span class="sc">==</span> <span class="st">"HFMD"</span>, <span class="dv">1</span> <span class="sc">-</span> ps, ps), <span class="co"># log reg</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">tw =</span> <span class="fu">twang_ps</span>(<span class="fu">pick</span>(<span class="fu">everything</span>())),        <span class="co"># twang 1 </span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">t2 =</span> <span class="fu">twang_ps</span>(<span class="fu">pick</span>(<span class="fu">everything</span>()),         <span class="co"># twang 2</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">n.trees =</span> <span class="dv">5000</span>,</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">interaction.depth =</span> <span class="dv">2</span>))),</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">mdifow =</span> <span class="fu">map_dbl</span>(dataset, get_max_diff, <span class="st">"ow"</span>),</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">mdiftw =</span> <span class="fu">map_dbl</span>(dataset, get_max_diff, <span class="st">"tw"</span>),</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">mdift2 =</span> <span class="fu">map_dbl</span>(dataset, get_max_diff, <span class="st">"t2"</span>),</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> <span class="fu">map</span>(response, <span class="sc">~</span> <span class="fu">reformulate</span>(<span class="st">"group"</span>, .x)),</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">glm0 =</span> <span class="fu">map2</span>(formula, dataset, <span class="sc">~</span> <span class="fu">glm</span>(.x, <span class="at">data =</span> .y)),</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">glm1 =</span> <span class="fu">map2</span>(response, dataset, <span class="sc">~</span> <span class="fu">glm</span>(<span class="fu">reformulate2</span>(.x), <span class="at">data =</span> .y)),</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">m_ow =</span> <span class="fu">map2</span>(formula, dataset, <span class="sc">~</span> <span class="fu">svyglm2</span>(.x, .y, <span class="sc">~</span>ow)),</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">m_tw =</span> <span class="fu">map2</span>(formula, dataset, <span class="sc">~</span> <span class="fu">svyglm2</span>(.x, .y, <span class="sc">~</span>tw)),</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">m_t2 =</span> <span class="fu">map2</span>(formula, dataset, <span class="sc">~</span> <span class="fu">svyglm2</span>(.x, .y, <span class="sc">~</span>t2)),</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 - logistic regression without any covariate:         </span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">cf_l0 =</span> <span class="fu">map_dbl</span>(glm0, coef2),</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">ci =</span> <span class="fu">map</span>(glm0, confint2)) <span class="sc">|&gt;</span>   </span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(ci) <span class="sc">|&gt;</span> </span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(.x, <span class="st">"l0"</span>), <span class="fu">ends_with</span>(<span class="st">"%"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_l0 =</span> <span class="fu">map_dbl</span>(glm0, get_p),</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 - logistic regression with covariates:</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">cf_l1 =</span> <span class="fu">map_dbl</span>(glm1, coef2),</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">ci =</span> <span class="fu">map</span>(glm1, confint2)) <span class="sc">|&gt;</span> </span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(ci) <span class="sc">|&gt;</span> </span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(.x, <span class="st">"l1"</span>), <span class="fu">ends_with</span>(<span class="st">"%"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_l1 =</span> <span class="fu">map_dbl</span>(glm1, get_p),</span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 - weights calculated from a logistic regression:         </span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">cf_ow =</span> <span class="fu">map_dbl</span>(m_ow, coef2),</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">ci =</span> <span class="fu">map</span>(m_ow, confint2)) <span class="sc">|&gt;</span> </span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(ci) <span class="sc">|&gt;</span> </span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(.x, <span class="st">"ow"</span>), <span class="fu">ends_with</span>(<span class="st">"%"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_ow =</span> <span class="fu">map_dbl</span>(m_ow, get_p),</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 - weights calculated from TWANG with default parameters:         </span></span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>         <span class="at">cf_tw =</span> <span class="fu">map_dbl</span>(m_tw, coef2),</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>         <span class="at">ci =</span> <span class="fu">map</span>(m_tw, confint2)) <span class="sc">|&gt;</span> </span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(ci) <span class="sc">|&gt;</span> </span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(.x, <span class="st">"tw"</span>), <span class="fu">ends_with</span>(<span class="st">"%"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_tw =</span> <span class="fu">map_dbl</span>(m_tw, get_p),</span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 - weights calculated from TWANG with Saras' parameters:         </span></span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">cf_t2 =</span> <span class="fu">map_dbl</span>(m_t2, coef2),</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">ci =</span> <span class="fu">map</span>(m_t2, confint2)) <span class="sc">|&gt;</span> </span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(ci) <span class="sc">|&gt;</span> </span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(.x, <span class="st">"t2"</span>), <span class="fu">ends_with</span>(<span class="st">"%"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_t2 =</span> <span class="fu">map_dbl</span>(m_t2, get_p))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="tmle" class="level3" data-number="13.3">
<h3 data-number="13.3" class="anchored" data-anchor-id="tmle"><span class="header-section-number">13.3</span> TMLE</h3>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>tmle2 <span class="ot">&lt;-</span> <span class="cf">function</span>(data, response, <span class="at">family =</span> <span class="st">"gaussian"</span>,</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Qlib =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.glmnet"</span>, <span class="st">"SL.mean"</span>, <span class="st">"SL.gam"</span>),</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">glib =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.glmnet"</span>, <span class="st">"SL.mean"</span>, <span class="st">"SL.gam"</span>), ...) {</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Gender, age, MomEdu, stunting) <span class="sc">|&gt;</span> </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.character</span>(.x) <span class="sc">|</span> <span class="fu">is.logical</span>(.x)), as.factor),</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">across</span>(age, as.numeric)) <span class="sc">|&gt;</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tmle</span>(data[[response]], <span class="fu">as.integer</span>(data<span class="sc">$</span>group <span class="sc">==</span> <span class="st">"HFMD"</span>), <span class="at">W =</span> _, <span class="at">family =</span> family,</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">Q.SL.library =</span> Qlib, <span class="at">g.SL.library =</span> glib)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>(out<span class="sc">$</span>estimates<span class="sc">$</span>ATT[<span class="fu">c</span>(<span class="st">"psi"</span>, <span class="st">"CI"</span>, <span class="st">"pvalue"</span>)])</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tmle2</span>(<span class="fu">make_data</span>(<span class="st">"FM"</span>, <span class="st">"enrollment"</span>), <span class="st">"FM"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        psi         CI1         CI2      pvalue 
-1.71308010 -3.19272660 -0.23343360  0.02325775 </code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>